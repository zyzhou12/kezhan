!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.BoardSDK=e():t.BoardSDK=e()}(window,function(){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(r,o,function(e){return t[e]}.bind(null,o));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e){t.exports=r;var i=null;try{i=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}function r(t,e,i){this.low=0|t,this.high=0|e,this.unsigned=!!i}function o(t){return!0===(t&&t.__isLong__)}r.prototype.__isLong__,Object.defineProperty(r.prototype,"__isLong__",{value:!0}),r.isLong=o;var n={},s={};function a(t,e){var i,r,o;return e?(o=0<=(t>>>=0)&&t<256)&&(r=s[t])?r:(i=d(t,(0|t)<0?-1:0,!0),o&&(s[t]=i),i):(o=-128<=(t|=0)&&t<128)&&(r=n[t])?r:(i=d(t,t<0?-1:0,!1),o&&(n[t]=i),i)}function l(t,e){if(isNaN(t))return e?y:m;if(e){if(t<0)return y;if(t>=f)return v}else{if(t<=-g)return q;if(t+1>=g)return w}return t<0?l(-t,e).neg():d(t%p|0,t/p|0,e)}function d(t,e,i){return new r(t,e,i)}r.fromInt=a,r.fromNumber=l,r.fromBits=d;var h=Math.pow;function c(t,e,i){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return m;if("number"==typeof e?(i=e,e=!1):e=!!e,(i=i||10)<2||36<i)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return c(t.substring(1),e,i).neg();for(var o=l(h(i,8)),n=m,s=0;s<t.length;s+=8){var a=Math.min(8,t.length-s),d=parseInt(t.substring(s,s+a),i);if(a<8){var u=l(h(i,a));n=n.mul(u).add(l(d))}else n=(n=n.mul(o)).add(l(d))}return n.unsigned=e,n}function u(t,e){return"number"==typeof t?l(t,e):"string"==typeof t?c(t,e):d(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}r.fromString=c,r.fromValue=u;var p=4294967296,f=p*p,g=f/2,_=a(1<<24),m=a(0);r.ZERO=m;var y=a(0,!0);r.UZERO=y;var b=a(1);r.ONE=b;var T=a(1,!0);r.UONE=T;var D=a(-1);r.NEG_ONE=D;var w=d(-1,2147483647,!1);r.MAX_VALUE=w;var v=d(-1,-1,!0);r.MAX_UNSIGNED_VALUE=v;var q=d(0,-2147483648,!1);r.MIN_VALUE=q;var B=r.prototype;B.toInt=function(){return this.unsigned?this.low>>>0:this.low},B.toNumber=function(){return this.unsigned?(this.high>>>0)*p+(this.low>>>0):this.high*p+(this.low>>>0)},B.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(q)){var e=l(t),i=this.div(e),r=i.mul(e).sub(this);return i.toString(t)+r.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var o=l(h(t,6),this.unsigned),n=this,s="";;){var a=n.div(o),d=(n.sub(a.mul(o)).toInt()>>>0).toString(t);if((n=a).isZero())return d+s;for(;d.length<6;)d="0"+d;s=""+d+s}},B.getHighBits=function(){return this.high},B.getHighBitsUnsigned=function(){return this.high>>>0},B.getLowBits=function(){return this.low},B.getLowBitsUnsigned=function(){return this.low>>>0},B.getNumBitsAbs=function(){if(this.isNegative())return this.eq(q)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},B.isZero=function(){return 0===this.high&&0===this.low},B.eqz=B.isZero,B.isNegative=function(){return!this.unsigned&&this.high<0},B.isPositive=function(){return this.unsigned||this.high>=0},B.isOdd=function(){return 1==(1&this.low)},B.isEven=function(){return 0==(1&this.low)},B.equals=function(t){return o(t)||(t=u(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&this.high===t.high&&this.low===t.low},B.eq=B.equals,B.notEquals=function(t){return!this.eq(t)},B.neq=B.notEquals,B.ne=B.notEquals,B.lessThan=function(t){return this.comp(t)<0},B.lt=B.lessThan,B.lessThanOrEqual=function(t){return this.comp(t)<=0},B.lte=B.lessThanOrEqual,B.le=B.lessThanOrEqual,B.greaterThan=function(t){return this.comp(t)>0},B.gt=B.greaterThan,B.greaterThanOrEqual=function(t){return this.comp(t)>=0},B.gte=B.greaterThanOrEqual,B.ge=B.greaterThanOrEqual,B.compare=function(t){if(o(t)||(t=u(t)),this.eq(t))return 0;var e=this.isNegative(),i=t.isNegative();return e&&!i?-1:!e&&i?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},B.comp=B.compare,B.negate=function(){return!this.unsigned&&this.eq(q)?q:this.not().add(b)},B.neg=B.negate,B.add=function(t){o(t)||(t=u(t));var e=this.high>>>16,i=65535&this.high,r=this.low>>>16,n=65535&this.low,s=t.high>>>16,a=65535&t.high,l=t.low>>>16,h=0,c=0,p=0,f=0;return p+=(f+=n+(65535&t.low))>>>16,c+=(p+=r+l)>>>16,h+=(c+=i+a)>>>16,h+=e+s,d((p&=65535)<<16|(f&=65535),(h&=65535)<<16|(c&=65535),this.unsigned)},B.subtract=function(t){return o(t)||(t=u(t)),this.add(t.neg())},B.sub=B.subtract,B.multiply=function(t){if(this.isZero())return m;if(o(t)||(t=u(t)),i)return d(i.mul(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned);if(t.isZero())return m;if(this.eq(q))return t.isOdd()?q:m;if(t.eq(q))return this.isOdd()?q:m;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(_)&&t.lt(_))return l(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,r=65535&this.high,n=this.low>>>16,s=65535&this.low,a=t.high>>>16,h=65535&t.high,c=t.low>>>16,p=65535&t.low,f=0,g=0,y=0,b=0;return y+=(b+=s*p)>>>16,g+=(y+=n*p)>>>16,y&=65535,g+=(y+=s*c)>>>16,f+=(g+=r*p)>>>16,g&=65535,f+=(g+=n*c)>>>16,g&=65535,f+=(g+=s*h)>>>16,f+=e*p+r*c+n*h+s*a,d((y&=65535)<<16|(b&=65535),(f&=65535)<<16|(g&=65535),this.unsigned)},B.mul=B.multiply,B.divide=function(t){if(o(t)||(t=u(t)),t.isZero())throw Error("division by zero");var e,r,n;if(i)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?d((this.unsigned?i.div_u:i.div_s)(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?y:m;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return y;if(t.gt(this.shru(1)))return T;n=y}else{if(this.eq(q))return t.eq(b)||t.eq(D)?q:t.eq(q)?b:(e=this.shr(1).div(t).shl(1)).eq(m)?t.isNegative()?b:D:(r=this.sub(t.mul(e)),n=e.add(r.div(t)));if(t.eq(q))return this.unsigned?y:m;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();n=m}for(r=this;r.gte(t);){e=Math.max(1,Math.floor(r.toNumber()/t.toNumber()));for(var s=Math.ceil(Math.log(e)/Math.LN2),a=s<=48?1:h(2,s-48),c=l(e),p=c.mul(t);p.isNegative()||p.gt(r);)p=(c=l(e-=a,this.unsigned)).mul(t);c.isZero()&&(c=b),n=n.add(c),r=r.sub(p)}return n},B.div=B.divide,B.modulo=function(t){return o(t)||(t=u(t)),i?d((this.unsigned?i.rem_u:i.rem_s)(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},B.mod=B.modulo,B.rem=B.modulo,B.not=function(){return d(~this.low,~this.high,this.unsigned)},B.and=function(t){return o(t)||(t=u(t)),d(this.low&t.low,this.high&t.high,this.unsigned)},B.or=function(t){return o(t)||(t=u(t)),d(this.low|t.low,this.high|t.high,this.unsigned)},B.xor=function(t){return o(t)||(t=u(t)),d(this.low^t.low,this.high^t.high,this.unsigned)},B.shiftLeft=function(t){return o(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?d(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):d(0,this.low<<t-32,this.unsigned)},B.shl=B.shiftLeft,B.shiftRight=function(t){return o(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?d(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):d(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},B.shr=B.shiftRight,B.shiftRightUnsigned=function(t){if(o(t)&&(t=t.toInt()),0==(t&=63))return this;var e=this.high;return t<32?d(this.low>>>t|e<<32-t,e>>>t,this.unsigned):d(32===t?e:e>>>t-32,0,this.unsigned)},B.shru=B.shiftRightUnsigned,B.shr_u=B.shiftRightUnsigned,B.toSigned=function(){return this.unsigned?d(this.low,this.high,!1):this},B.toUnsigned=function(){return this.unsigned?this:d(this.low,this.high,!0)},B.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},B.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},B.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},r.fromBytes=function(t,e,i){return i?r.fromBytesLE(t,e):r.fromBytesBE(t,e)},r.fromBytesLE=function(t,e){return new r(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},r.fromBytesBE=function(t,e){return new r(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)}},function(t,e,i){"use strict";i.r(e);var r=function(t,e){this.user=t,this.type=e.type,this.seq=e.seq},o={decimalToRgba(t){var e=[];return t.replace(/../g,function(t){e.push(parseInt(t,16))}),"rgba("+e.join(",")+",1)"},hexToRgba(t){var e;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(t))return 3==(e=t.substring(1).split("")).length&&(e=[e[0],e[0],e[1],e[1],e[2],e[2]]),t="#"+e.join(""),"rgba("+parseInt("0x"+t.slice(1,3))+","+parseInt("0x"+t.slice(3,5))+","+parseInt("0x"+t.slice(5,7))+",1)"},rgbaToDecimal(t){for(var e=t.toString().match(/\d+/g),i="",r=0;r<3;r++)i+=("0"+Number(e[r]).toString(16)).slice(-2);return i},dealColor(t){if(t<0)return"rgba("+(t>>24&255)+","+(t>>16&255)+","+(t>>8&255)+",1)";var e=parseInt(t).toString(16);return e=(e="000000"+(e=e.substr(0,e.length-2))).substring(e.length-6,e.length),this.decimalToRgba(e)},formatColor(t){var e=this.rgbaToDecimal(t);return parseInt(e+"ff",16)},getEffectivePoint:(t,e)=>(t<=0?t=Math.floor(e/2):t>=1e4&&(t=1e4-Math.floor(e/2)),t),getAVSdkTimestamp(){var t=Date.now()+"",e=t.substring(0,5)+"00000000",i=t.substr(5),r=parseInt(e,10).toString(2).substr(-32);return parseInt(r,2)+(4294967295&i)},getTimeStamp:()=>(new Date).getTime(),getSecondTime(){return parseInt(this.getTimeStamp()/1e3)},getTimeDiff:t=>(new Date).getTime()-t,boardId2Fid:t=>t.substring(t.indexOf("#")),boardIdGetSeq:t=>t.match(/\d+_#/)[0].replace(/\D/gi,"")};function n(t,e){this.user=t,this.type="line",this.seq=e.belongSeq,this.belongSeq=e.belongSeq,this.show=e.show,this.status="begin",this.select=!1,this.color=e.color,this.time=o.getTimeStamp(),this.thin=e.thin,this.startSeq=e.belongSeq,this.endSeq=0,this.lines=[{x:e.x,y:e.y,belongSeq:e.belongSeq,seq:e.seq}],this.border={maxX:e.x,maxY:e.y,minX:e.x,minY:e.y}}n.prototype.setBorder=function(t,e){t+this.thin>this.border.maxX&&(this.border.maxX=o.getEffectivePoint(t+this.thin,this.thin)),t-this.thin<this.border.minX&&(this.border.minX=o.getEffectivePoint(t-this.thin,this.thin)),e+this.thin>this.border.maxY&&(this.border.maxY=o.getEffectivePoint(e+this.thin,this.thin)),e-this.thin<this.border.minY&&(this.border.minY=o.getEffectivePoint(e-this.thin,this.thin))},n.prototype.sort=function(){this.lines.sort(function(t,e){return t.seq-e.seq})};var s=n,a=function(t,e){this.user=t,this.type="graph",this.graph=e.graph,this.seq=e.seq,this.show=e.show,this.status="begin",this.select=!1,this.time=o.getTimeStamp(),this.color=e.color,this.thin=e.thin,this.solid=e.solid||!1,this.startPoint={x:e.beginPoint.x,y:e.beginPoint.y,seq:e.beginPoint.seq},this.endPoint={x:e.endPoint.x,y:e.endPoint.y,seq:e.endPoint.seq}},l=function(t,e){this.user=t,this.type="select",this.seq=Math.floor(100*Math.random()),this.show=!0,this.color=e.color,this.startInfo={x:e.startx,y:e.starty},this.location={x:e.x,y:e.y}},d=function(t,e){this.user=t,this.type="raser",this.seq=e.seq,this.show=!0,this.status=1,this.color=e.color,this.radius=e.radius,this.location={x:e.x,y:e.y}},h=i(0),c=i.n(h),u={seq:0,getSeq(){var t=Math.round((new Date).getTime()/1e3);return 1*new c.a(t>>>0<<15|32767&this.seq++,t>>>0>>17).toString()}};function p(){}p.prototype.on=function(t,e){return this._cbs=this._cbs||{},(this._cbs[t]||(this._cbs[t]=[])).unshift(e),this},p.prototype.off=function(t,e){if(this._cbs=this._cbs||{},!t)return this._cbs={};if(!e)return delete this._cbs[t];for(var i,r=this._cbs[t]||[];r&&~(i=r.indexOf(e));)r.splice(i,1);return this},p.prototype.fire=function(t=this,e,i){this._cbs=this._cbs||{};var r=this._cbs[e];if(r)for(var o=r.length;o--;)r[o].apply(t,[i]);return this};var f=new p,g={VERSION:"2.3.0",PLATFORM:"web",SERVER_URL:"https://yun.tim.qq.com/v4/ilvb_edu/whiteboard?contenttype=json&sdkappid=",TEST_SERVER_URL:"https://test.tim.qq.com/v4/ilvb_test/whiteboard?contenttype=json&sdkappid=",COS_SERVER_URL:"https://cloud.tim.qq.com/v4/ilvb_cos/cos",TEST_COS_SERVER_URL:"https://cloud-test.tim.qq.com/v4/ilvb_cos_test/cos",WHITELIST_SERVER_URL:"https://yun.tim.qq.com/v4/ilvb_edu/whitelist?contenttype=json&sdkappid=",TEST_WHITELIST_SERVER_URL:"https://test.tim.qq.com/v4/ilvb_test/whitelist?contenttype=json&sdkappid=",SUB_CMD:{GET_BOARD_DATA:"get_board_data",REPORT_BOARD_DATA:"report_board_data"},COMMON_GROUP:"#DEFAULT",COMMON_DEFAULT_BOARD:"#DEFAULT",THIN:100,RADIUS:100,TEXT_MAX_LENGTH:140,TEXT_SIZE:14,TEXT_COLOR:0,TEXT_FONT_FAMILY:"sans-serif,serif,monospace",TEXT_FONT_STYLE:{NORMAL:0,BOLD:1,ITALIC:2,BOLD_ITALIC:3},PROTOCOL_ACTION:{LINE_START_ACTION:1,LINE_MOVE_ACTION:2,LINE_END_ACTION:3,RASER_SHOW_ACTION:6,RASER_HIDE_ACTION:7,ERASER_ACTION:8,MOVE_LINE_GRAPH_ACTION:9,GRAPH_LINE_ACTION:10,GRAPH_CIRCLE_ACTION:11,GRAPH_RECT_ACTION:12,INPUT_TEXT_ACTION:13,GRAPH_CLEAR_ALL_ACTION:101,GRAPH_CLEAR_ACTION:102,UPDATE_BG_IMG_ACTION:201,DELETE_BG_IMG_ACTION:202,UPDATE_BG_COLOR_ACTION:203,BOARD_MOVE_SCALE_ACTION:301,SWITCH_ACTION:401,ADD_FILE_ACTION:501}},_={LINE:"line",ERASER:"eraser",RASER:"raser",POINTSELECT:"pointselect",SELECT:"select",MOVE:"move","GRAPH-LINE":"graph-line","GRAPH-CIRCLE":"graph-circle","GRAPH-RECT":"graph-rect","GRAPH-OVAL":"graph-oval","GRAPH-CIRCLE-SOLID":"graph-circle-solid","GRAPH-RECT-SOLID":"graph-rect-solid","GRAPH-OVAL-SOLID":"graph-oval-solid",INPUTTEXT:"inputtext"},m={RED:4278190335,WHITE:4294967295},y={HISTROY_DATA_COMPLETE:"histroy_data_complete",ADD_BOARD:"add_board",RT_DATA:"real_time_data",DELETE_BOARD:"delete_board",SWITCH_BOARD:"switch_board",ADD_FILE:"add_group",DELETE_FILE:"delete_group",SWITCH_FILE:"switch_group",IMG_START_LOAD:"img_start_load",IMG_LOAD:"img_load",IMG_ERROR:"img_error",IMG_ABORT:"img_abort",PRELOAD:"preload",VERIFY_SDK_SUCC:"verify_sdk_succ",VERIFY_SDK_ERROR:"verify_sdk_error",CANVAS_MOUSEDOWN:"canvas_mousedown",CANVAS_MOUSEMOVE:"canvas_mousemove",CANVAS_MOUSEUP:"canvas_mouseup",CANVAS_MOUSELEAVE:"canvas_mouseleave",COS:{GET_SIGN_ERROR:"get_sign_error",TASK_READY:"task_ready",HASH_PROGRESS:"hash_progress",PROGRESS:"progress",GET_SIGN_SUCCESS:"get_sign_success",DOES_NOT_SUPPORT_UPLOAD:"does_not_support_upload",UPLOAD_SUCCESS:"upload_success",UPLOAD_ERROR:"upload_error"}};function b(){}b.prototype={APIURL:"https://ilivelog.qcloud.com",method:"POST",events:{start_draw_curve:"start_draw_curve",move_draw_curve:"move_draw_curve",end_draw_curve:"end_draw_curve",over_draw_curve:"over_draw_curve",start_raser:"start_raser",end_raser:"end_raser",eraser:"eraser",move_scrawl:"move_scrawl",draw_graph:"draw_graph",clear_all:"clear_all",clear_scrawl:"clear_scrawl",set_bg_img:"set_bg_img",clear_bg_img:"clear_bg_img",set_bg_color:"set_bg_color",switch_board:"switch_board",start_select:"start_select",move_select:"move_select",end_select:"end_select",point_select:"point_select"},levels:{info:"info",warn:"warn",error:"error"},send:function(t){try{t.userAgent=navigator.userAgent,t=this.fillDatas(t);var e=this.getXHR();e.onreadystatechange=this.reporterHandel(this),e.open(this.method,this.APIURL,!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send(JSON.stringify(t))}catch(t){console.log(t)}},fillDatas:function(t){var e={};for(var i in this.defDatas)["sdkappid","classid","userid"].indexOf(i)>=0?e[i]=this.defDatas[i]:e[i]=void 0!==t[i]?t[i]:this.defDatas[i];return e},datasParseToString:function(t){var e=[];for(var i in t)e.push(i+"="+encodeURIComponent(t[i]));return e.join("&")},getXHR:function(){var t=null;if(window.XMLHttpRequest)t=new XMLHttpRequest;else if(window.ActiveXObject)try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}if(null!=t)return t;console.log("Your browser does not support XMLHTTP.")},reporterHandel:function(){return function(t){t&&t.readyState&&t.readyState}},log:function(t,e){this.send({action:t,action_result:e||0,log_msg:t,log_level:this.levels.info})},warn:function(t,e){this.send({action:t,action_result:e||0,log_msg:t,log_level:this.levels.warn})},error:function(t,e){this.send({action:t,action_result:e||0,log_msg:t,log_level:this.levels.error})},defDatas:{action:"",version:g.VERSION,action_result:0,action_info:"",userid:"",time_consume:0,sdkappid:"",device:"web",log_time:0,business:"ticsdk",roomid:"",boardid:"",image_url:"",boardid_list:[],to_boardId:"",color:null,file_id:"",file_title:"",isfinish:0,msgLength:20,bucket:"",cos_appid:null,extra_info:"",net_type:"unknown",net_type:null,userAgent:null},setSdkAppid:function(t){null!=t&&null!=t?this.defDatas.sdkappid=t:console.log("sdkappid invalid!")},setRoomId:function(t){null!=t&&null!=t?this.defDatas.roomid=t:console.log("roomid invalid!")},setUserId:function(t){null!=t&&null!=t?this.defDatas.userid=t:console.log("userid invalid!")},boardAction(t,e){this.report(t,e)},report(t,e={}){try{this.send(Object.assign({action_result:0,time_consume:0},e,{action:t,log_time:o.getTimeStamp()}))}catch(t){}}};var T=new b;function D(t){if(this.permissions=!1,this.option=Object.assign({},t),!this.option.tlsData)throw new Error("not found tlsData.sdkAppId|tlsData.identifie|tlsData.userSig");if(!this.option.tlsData.sdkAppId)throw new Error("not found tlsData.sdkAppId");if(!this.option.tlsData.identifier)throw new Error("not found tlsData.identifie");if(!this.option.tlsData.userSig)throw new Error("not found tlsData.userSig");this.BOARD_URL=(t.debug?g.TEST_SERVER_URL:g.SERVER_URL)+this.option.tlsData.sdkAppId,this.COS_SERVER_URL=t.debug?g.TEST_COS_SERVER_URL:g.COS_SERVER_URL,this.WHITELIST_SERVER_URL=(t.debug?g.TEST_WHITELIST_SERVER_URL:g.WHITELIST_SERVER_URL)+this.option.tlsData.sdkAppId}D.prototype.setPermissions=function(t=!1){this.permissions=t},D.prototype.initXmlHttp=function(){return XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},D.prototype.reportMsg=function(t,e,i){this.option.conf_id&&this.permissions&&(t={cmd:"open_conf_svc",sub_cmd:"report_board_data",conf_id:parseInt(this.option.conf_id,10),board_data_list:t},this.post(t,e,i))},D.prototype.getBoardData=function(t=!0,e,i){var r={first_time:t,seq:u.getSeq(),cmd:"open_conf_svc",sub_cmd:"get_board_data",conf_id:parseInt(this.option.conf_id,10)};this.post(r,e,i)},D.prototype.getLineData=function(t,e,i){var r=(new Date).getTime(),o={cmd:"open_conf_svc",sub_cmd:"get_line",conf_id:parseInt(this.option.conf_id,10),boardId:t.boardId,owner:t.owner,seq:t.seq};this.post(o,t=>{T.report("getLineData",{action_result:0,time_consume:(new Date).getTime()-r,extra_info:JSON.stringify(t)}),e&&e(t)},t=>{T.report("getLineData",{action_result:-1,time_consume:(new Date).getTime()-r,extra_info:JSON.stringify(t)}),i&&i(t)})},D.prototype.getDocTotalPage=function(t){return axios.get(t)},D.prototype.getCosAuthData=function(){var t=this.COS_SERVER_URL+`?SdkAppId=${this.option.tlsData.sdkAppId}&Identifier=${this.option.tlsData.identifier}&UserSig=${this.option.tlsData.identifier}`;return this.postPromise(t,{cmd:"open_cos_svc",sub_cmd:"get_cos_token",duration:300,version:1})},D.prototype.applyPermissions=function(){var t=this.WHITELIST_SERVER_URL+"&usersig="+this.option.tlsData.userSig+"&identifier="+this.option.tlsData.identifier;return this.postPromise(t,{cmd:"open_conf_svc",sub_cmd:"verify_sdk",sdkappid:1*this.option.tlsData.sdkAppId})},D.prototype.post=function(t,e,i){var r=this.BOARD_URL+"&usersig="+this.option.tlsData.userSig+"&identifier="+this.option.tlsData.identifier;wx.request({url:r,data:t,method:"POST",header:{"content-type":"application/json"},success:function(t){e(t.data)},fail:i})},D.prototype.postPromise=function(t,e){return t=t||this.BOARD_URL+"&usersig="+this.option.tlsData.userSig+"&identifier="+this.option.tlsData.identifier,new Promise((i,r)=>{wx.request({url:t,data:e,method:"POST",header:{"content-type":"application/json"},success:function(t){i(t)},fail:function(){r.apply(this,arguments)}})})},D.prototype.axiosPost=function(t,e,i,r){axios.post(t,e).then(function(t){console.log(t.data),i&&i(t.data)}).catch(function(t){r&&r(t)})},D.prototype.cPost=function(t,e,i,r){var o=this.initXmlHttp();o.open("POST",t,!0),o.setRequestHeader("Content-Type","application/json;charset=UTF-8"),o.send(JSON.stringify(e)),o.onreadystatechange=function(){if(4==o.readyState)if(o.status>=200&&o.status<300||304==o.status){var t=null;try{t=JSON.parse(o.responseText),console.log("data:",e,"  ret:",t),i&&i(t)}catch(t){r&&r(t)}}else{var n=new Error("Network Error");r&&r(n)}}};var w=D;function v(){this.wxSysData=wx.getSystemInfoSync()}v.prototype={APIURL:"https://ilivelog.qcloud.com",events:{start_draw_curve:"start_draw_curve",move_draw_curve:"move_draw_curve",end_draw_curve:"end_draw_curve",over_draw_curve:"over_draw_curve",start_raser:"start_raser",end_raser:"end_raser",eraser:"eraser",move_scrawl:"move_scrawl",draw_graph:"draw_graph",clear_all:"clear_all",clear_scrawl:"clear_scrawl",set_bg_img:"set_bg_img",clear_bg_img:"clear_bg_img",set_bg_color:"set_bg_color",switch_board:"switch_board",start_select:"start_select",move_select:"move_select",end_select:"end_select",point_select:"point_select"},levels:{info:"info",warn:"warn",error:"error"},send:function(t){this.defDatas.brand=this.wxSysData.brand,this.defDatas.model=this.wxSysData.model,this.defDatas.platform=this.wxSysData.platform,this.defDatas.system=this.wxSysData.system,this.defDatas.weixinversion=this.wxSysData.version;try{t=this.fillDatas(t),wx.request({url:this.APIURL,data:JSON.stringify(t),method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){},fail:function(t){}})}catch(t){}},fillDatas:function(t){var e={};for(var i in this.defDatas)["sdkappid","classid","userid"].indexOf(i)>=0?e[i]=this.defDatas[i]:e[i]=void 0!==t[i]?t[i]:this.defDatas[i];return e},datasParseToString:function(t){var e=[];for(var i in t)e.push(i+"="+encodeURIComponent(t[i]));return e.join("&")},getXHR:function(){var t=null;if(window.XMLHttpRequest)t=new XMLHttpRequest;else if(window.ActiveXObject)try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}if(null!=t)return t;console.log("Your browser does not support XMLHTTP.")},reporterHandel:function(){return function(t){t&&t.readyState&&t.readyState}},log:function(t,e){this.send({action:t,action_result:e||0,log_msg:t,log_level:this.levels.info})},warn:function(t,e){this.send({action:t,action_result:e||0,log_msg:t,log_level:this.levels.warn})},error:function(t,e){this.send({action:t,action_result:e||0,log_msg:t,log_level:this.levels.error})},defDatas:{action:"",version:g.VERSION,action_result:0,action_info:"",userid:"",time_consume:0,sdkappid:"",device:"miniprog",log_time:0,business:"ticsdk",roomid:"",boardid:"",image_url:"",boardid_list:[],to_boardId:"",color:null,file_id:"",file_title:"",isfinish:0,msgLength:20,bucket:"",cos_appid:null,extra_info:"",net_type:"unknown",net_type:null,userAgent:null,cookie:null,brand:null,model:null,platform:null,system:null,weixinversion:null},setSdkAppid:function(t){null!=t&&null!=t?this.defDatas.sdkappid=t:console.log("sdkappid invalid!")},setRoomId:function(t){null!=t&&null!=t?this.defDatas.roomid=t:console.log("roomid invalid!")},setUserId:function(t){null!=t&&null!=t?this.defDatas.userid=t:console.log("userid invalid!")},boardAction(t,e){this.report(t,e)},report(t,e={}){try{this.send(Object.assign({action_result:0,time_consume:0},e,{action:t,log_time:o.getTimeStamp()}))}catch(t){}}};var q=new v;function B(t){this.request=t}B.prototype.reportCreateBoards=function(t,e){var i;i=Array.isArray(e)?e:[e];var r=(new Date).getTime();this.request.reportMsg([{type:"createBoards",seq:u.getSeq(),content:{createBoards:i,updateTime:o.getTimeStamp()}}],function(e){e.ErrorCode||e.error_code?q.boardAction("createBoards",{action_result:e.ErrorCode?`ErrorCode:${e.ErrorCode}`:`error_code:${e.error_code}`,action_info:e.ErrorInfo||e.error_msg,time_consume:o.getTimeDiff(r),boardid:t,boardid_list:i,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):q.boardAction("createBoards",{action_result:0,action_info:null,time_consume:o.getTimeDiff(r),boardid:t,boardid_list:i,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(e){q.boardAction("createBoards",{action_result:-9999,action_info:e&&e.message,time_consume:o.getTimeDiff(r),boardid:t,boardid_list:i,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})},B.prototype.reportDeleteBoard=function(t,e){var i=(new Date).getTime();this.request.reportMsg([{type:"deleteBoards",seq:u.getSeq(),content:{deleteBoards:t,toBoardId:e,updateTime:o.getTimeStamp()}}],function(r){r.ErrorCode||r.error_code?q.boardAction("deleteBoards",{action_result:r.ErrorCode?`ErrorCode:${r.ErrorCode}`:`error_code:${r.error_code}`,action_info:r.ErrorInfo||r.error_msg,time_consume:o.getTimeDiff(i),boardid:null,boardid_list:t,image_url:null,to_boardId:e,color:null,file_id:null,file_title:null}):q.boardAction("deleteBoards",{action_result:0,action_info:null,time_consume:o.getTimeDiff(i),boardid:null,boardid_list:t,image_url:null,to_boardId:e,color:null,file_id:null,file_title:null})},function(r){q.boardAction("deleteBoards",{action_result:-9999,action_info:r&&r.message,time_consume:o.getTimeDiff(i),boardid:null,boardid_list:t,image_url:null,to_boardId:e,color:null,file_id:null,file_title:null})})},B.prototype.reportSetBoardBgColor=function(t,e){var i=(new Date).getTime();this.request.reportMsg([{type:"setBoardBG",seq:u.getSeq(),content:{boardId:t,updateTime:o.getTimeStamp(),colorRGBA:e}}],function(r){r.ErrorCode||r.error_code?q.boardAction("setBoardBG",{action_result:r.ErrorCode?`ErrorCode:${r.ErrorCode}`:`error_code:${r.error_code}`,action_info:r.ErrorInfo||r.error_msg,time_consume:o.getTimeDiff(i),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:e,file_id:null,file_title:null}):q.boardAction("setBoardBG",{action_result:0,action_info:null,time_consume:o.getTimeDiff(i),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:e,file_id:null,file_title:null})},function(r){q.boardAction("setBoardBG",{action_result:-9999,action_info:r&&r.message,time_consume:o.getTimeDiff(i),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:e,file_id:null,file_title:null})})},B.prototype.reportClear=function(t){var e=(new Date).getTime();this.request.reportMsg([{type:"clean",seq:u.getSeq(),content:{boardId:t,updateTime:o.getTimeStamp()}}],function(i){i.ErrorCode||i.error_code?q.boardAction("clean",{action_result:i.ErrorCode?`ErrorCode:${i.ErrorCode}`:`error_code:${i.error_code}`,action_info:i.ErrorInfo||i.error_msg,time_consume:o.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):q.boardAction("clean",{action_result:0,action_info:null,time_consume:o.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(i){q.boardAction("clean",{action_result:-9999,action_info:i&&i.message,time_consume:o.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})},B.prototype.reportClearDraws=function(t){var e=(new Date).getTime();this.request.reportMsg([{type:"cleanDraws",seq:u.getSeq(),content:{boardId:t,updateTime:o.getTimeStamp()}}],function(i){i.ErrorCode||i.error_code?q.boardAction("cleanDraws",{action_result:i.ErrorCode?`ErrorCode:${i.ErrorCode}`:`error_code:${i.error_code}`,action_info:i.ErrorInfo||i.error_msg,time_consume:o.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):q.boardAction("cleanDraws",{action_result:0,action_info:null,time_consume:o.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(i){q.boardAction("cleanDraws",{action_result:-9999,action_info:i&&i.message,time_consume:o.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})},B.prototype.reportImage=function(t,e){var i=(new Date).getTime();this.request.reportMsg([{type:"image",seq:u.getSeq(),content:{boardId:t,url:e,updateTime:o.getTimeStamp(),mode:0}}],function(r){var n={};n[t]=e,r.ErrorCode||r.error_code?q.boardAction("image",{action_result:r.ErrorCode?`ErrorCode:${r.ErrorCode}`:`error_code:${r.error_code}`,action_info:r.ErrorInfo||r.error_msg,time_consume:o.getTimeDiff(i),boardid:null,boardid_list:null,boardid_list:[n],to_boardId:null,color:null,file_id:null,file_title:null}):q.boardAction("image",{action_result:0,action_info:null,time_consume:o.getTimeDiff(i),boardid:null,boardid_list:null,boardid_list:[n],to_boardId:null,color:null,file_id:null,file_title:null})},function(t){q.boardAction("image",{action_result:-9999,action_info:t&&t.message,time_consume:o.getTimeDiff(i),boardid:null,boardid_list:null,boardid_list:[boardInfo],to_boardId:null,color:null,file_id:null,file_title:null})})},B.prototype.reportImages=function(t){var e=(new Date).getTime();this.request.reportMsg(t,function(i){var r=[];t.forEach(t=>{var e={};e[t.content.boardId]=t.content.url,r.push(e)}),i.ErrorCode||i.error_code?q.boardAction("image",{action_result:i.ErrorCode?`ErrorCode:${i.ErrorCode}`:`error_code:${i.error_code}`,action_info:i.ErrorInfo||i.error_msg,time_consume:o.getTimeDiff(e),boardid:null,boardid_list:null,boardid_list:r,to_boardId:null,color:null,file_id:null,file_title:null}):q.boardAction("image",{action_result:0,action_info:null,time_consume:o.getTimeDiff(e),boardid:null,boardid_list:null,boardid_list:r,to_boardId:null,color:null,file_id:null,file_title:null})},function(t){q.boardAction("image",{action_result:-9999,action_info:t&&t.message,time_consume:o.getTimeDiff(e),boardid:null,boardid_list:null,boardid_list:boardInfoList,to_boardId:null,color:null,file_id:null,file_title:null})})},B.prototype.reportSwitchBoard=function(t){var e=(new Date).getTime();this.request.reportMsg([{type:"switchBoard",seq:u.getSeq(),content:{boardId:t,updateTime:o.getTimeStamp()}}],function(i){i.ErrorCode||i.error_code?q.boardAction("switchBoard",{action_result:i.ErrorCode?`ErrorCode:${i.ErrorCode}`:`error_code:${i.error_code}`,action_info:i.ErrorInfo||i.error_msg,time_consume:o.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):q.boardAction("switchBoard",{action_result:0,action_info:null,time_consume:o.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(i){q.boardAction("switchBoard",{action_result:-9999,action_info:i&&i.message,time_consume:o.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})},B.prototype.reportGlobalBgColor=function(t){var e=(new Date).getTime();this.request.reportMsg([{type:"setGlobalBG",seq:u.getSeq(),content:{updateTime:o.getTimeStamp(),colorRGBA:t}}],function(i){i.ErrorCode||i.error_code?q.boardAction("setGlobalBG",{action_result:i.ErrorCode?`ErrorCode:${i.ErrorCode}`:`error_code:${i.error_code}`,action_info:i.ErrorInfo||i.error_msg,time_consume:o.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:t,file_id:null,file_title:null}):q.boardAction("setGlobalBG",{action_result:0,action_info:null,time_consume:o.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:t,file_id:null,file_title:null})},function(i){q.boardAction("setGlobalBG",{action_result:-9999,action_info:i&&i.message,time_consume:o.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:t,file_id:null,file_title:null})})},B.prototype.reportAddLine=function(t){var e=(new Date).getTime();this.request.reportMsg([{type:"addLine",seq:u.getSeq(),content:t}],function(i){i.ErrorCode||i.error_code?q.boardAction("addLine",{action_result:i.ErrorCode?`ErrorCode:${i.ErrorCode}`:`error_code:${i.error_code}`,action_info:i.ErrorInfo||i.error_msg,time_consume:o.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null}):q.boardAction("addLine",{action_result:0,action_info:null,time_consume:o.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null})},function(i){q.boardAction("addLine",{action_result:-9999,action_info:i&&i.message,time_consume:o.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null})})},B.prototype.reportDisplayLine=function(t){var e=(new Date).getTime();this.request.reportMsg([{type:"displayLine",seq:u.getSeq(),content:t}],function(i){i.ErrorCode||i.error_code?q.boardAction("displayLine",{action_result:i.ErrorCode?`ErrorCode:${i.ErrorCode}`:`error_code:${i.error_code}`,action_info:i.ErrorInfo||i.error_msg,time_consume:o.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null,display:t.display}):q.boardAction("displayLine",{action_result:0,action_info:null,time_consume:o.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null,display:t.display})},function(i){q.boardAction("displayLine",{action_result:-9999,action_info:i&&i.message,time_consume:o.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null,display:t.display})})},B.prototype.reportGraphData=function(t){var e=(new Date).getTime();this.request.reportMsg(t,function(i){t.forEach(t=>{i.ErrorCode||i.error_code?q.boardAction(t.type,{action_result:i.ErrorCode?`ErrorCode:${i.ErrorCode}`:`error_code:${i.error_code}`,action_info:i.ErrorInfo||i.error_msg,time_consume:o.getTimeDiff(e),boardid:t.content.boardId,boardid_list:null,boardid_list:null,to_boardId:null,color:t.content.colorRGBA,file_id:null,file_title:null}):q.boardAction(t.type,{action_result:0,action_info:null,time_consume:o.getTimeDiff(e),boardid:t.content.boardId,boardid_list:null,boardid_list:null,to_boardId:null,color:t.content.colorRGBA,file_id:null,file_title:null})})},function(i){t.forEach(t=>{q.boardAction(t.type,{action_result:-9999,action_info:i&&i.message,time_consume:o.getTimeDiff(e),boardid:t.content.boardId,boardid_list:null,boardid_list:boardInfoList,to_boardId:null,color:t.content.colorRGBA,file_id:null,file_title:null})})})},B.prototype.reportAddFile=function(t,e){var i=(new Date).getTime();this.request.reportMsg([{type:"addFile",seq:u.getSeq(),content:{updateTime:o.getTimeStamp(),fid:t,title:e}}],function(r){r.ErrorCode||r.error_code?q.boardAction("addFile",{action_result:r.ErrorCode?`ErrorCode:${r.ErrorCode}`:`error_code:${r.error_code}`,action_info:r.ErrorInfo||r.error_msg,time_consume:o.getTimeDiff(i),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:e}):q.boardAction("addFile",{action_result:0,action_info:null,time_consume:o.getTimeDiff(i),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:e})},function(r){q.boardAction("addFile",{action_result:-9999,action_info:r&&r.message,time_consume:o.getTimeDiff(i),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:e})})},B.prototype.reportDeleteFile=function(t){var e=(new Date).getTime();this.request.reportMsg([{type:"deleteFile",seq:u.getSeq(),content:{fid:t,updateTime:o.getTimeStamp()}}],function(i){i.ErrorCode||i.error_code?q.boardAction("deleteFile",{action_result:i.ErrorCode?`ErrorCode:${i.ErrorCode}`:`error_code:${i.error_code}`,action_info:i.ErrorInfo||i.error_msg,time_consume:o.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:null}):q.boardAction("deleteFile",{action_result:0,action_info:null,time_consume:o.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:null})},function(i){q.boardAction("deleteFile",{action_result:-9999,action_info:i&&i.message,time_consume:o.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:null})})},B.prototype.reportCleanAll=function(){var t=(new Date).getTime();this.request.reportMsg([{type:"cleanAll",seq:u.getSeq()}],e=>{e.ErrorCode||e.error_code?q.boardAction("cleanAll",{action_result:e.ErrorCode?`ErrorCode:${e.ErrorCode}`:`error_code:${e.error_code}`,action_info:e.ErrorInfo||e.error_msg,time_consume:o.getTimeDiff(t),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):q.boardAction("cleanAll",{action_result:0,action_info:null,time_consume:o.getTimeDiff(t),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},e=>{q.boardAction("cleanAll",{action_result:-9999,action_info:e&&e.message,time_consume:o.getTimeDiff(t),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})};var S=B;function P(t){this.options=JSON.parse(JSON.stringify(t)),this.preStep=t.preStep||2,this.context=t.context,this.maxSeq=0,this.request=new w(t),this.report=new S(this.request),this.permissions=0,this.applyPermissions(),this.syncHistroy=t.syncHistroy||!0,this.identifier=t.tlsData.identifier,this.conf_id=t.conf_id,this.user=t.tlsData.identifier,q.setSdkAppid(t.tlsData.sdkAppId),q.setRoomId(this.conf_id),q.setUserId(t.tlsData.identifier),this.data={},this.opData={},this.opIndex={},this.userData={},this.backgroundPic={},this.backgroundColor={},this.currentGroup=null,this.currentBoard=null,this.boardList=[],this.groups=[],this.color=0,this.thin=0,this.radius=0,this.globalBackgroundColor=0,this.type=null,this.transparent=!1,this.seq=0,this.selectedList=[],this.selectArea={},this.gSeq=0,this.boardIdSeq=0,this.belongLineSeq=0,this.realTimeData=[],this.beforeMoveType="",this.initInterval(),this.initData(t)}P.prototype.applyPermissions=function(){var t=Date.now();this.request.applyPermissions().then(e=>{try{0===e.data.error_code&&e.data.level?(this.permissions=e.data.level,this.request.setPermissions(this.permissions),this.syncHistroy&&this.conf_id&&this.syncHistroyData(),f.fire(this,y.VERIFY_SDK_SUCC),q.report("verify_sdk",{time_consume:Date.now()-t,extra_info:JSON.stringify({permissions:this.permissions})})):(this.permissions=0,this.request.setPermissions(this.permissions),f.fire(this,y.VERIFY_SDK_ERROR),q.report("verify_sdk",{action_result:e.data.error_code,action_info:JSON.stringify(e.data),time_consume:Date.now()-t,extra_info:JSON.stringify({permissions:this.permissions})}))}catch(e){this.permissions=0,this.request.setPermissions(this.permissions),f.fire(this,y.VERIFY_SDK_ERROR),q.report("verify_sdk",{action_result:-2,action_info:JSON.stringify(e),time_consume:Date.now()-t,extra_info:JSON.stringify({permissions:this.permissions})})}this.needDraw=!0},e=>{this.permissions=0,this.request.setPermissions(this.permissions),f.fire(this,y.VERIFY_SDK_ERROR),q.report("verify_sdk",{action_result:-1,action_info:JSON.stringify(e),time_consume:Date.now()-t,extra_info:JSON.stringify({permissions:this.permissions})}),this.needDraw=!0})},P.prototype.createBoardId=function(t=this.currentGroup){return 0==this.boardIdSeq?(this.boardIdSeq++,g.COMMON_DEFAULT_BOARD):`${g.PLATFORM}_${this.identifier}_${parseInt((new Date).getTime()/1e3)}_${this.boardIdSeq++}_${t}`},P.prototype.initInterval=function(){this.sendInterval=setInterval(()=>{this.realTimeData.length>0&&this.sendRequest()},200)},P.prototype.initData=function(t){this.setColor(t.color),this.setThin(t.thin),this.setRadius(t.radius),this.setType(t.type),this.setGlobalBackgroundColor(t.globalBackgroundColor,!0),this.setTransparent(t.transparent),this.setSelectArea()},P.prototype.addBoard=function(t,e=!0){var i=[];if(Array.isArray(t))i=t;else{if(!t)return;i=[t]}return i.forEach((t,e)=>{this.userData[t]={},this.userData[t][this.identifier]=[],this.data[t]=[],this.opData[t]=[],this.opIndex[t]=0,this.backgroundColor[t]=this.globalBackgroundColor,this.backgroundPic[t]={url:"",user:this.identifier,show:!0},-1===this.boardList.indexOf(t)&&this.boardList.push(t)}),setTimeout(()=>{f.fire(this,y.ADD_BOARD,{current:this.currentBoard,list:this.boardList})},100),e&&this.report.reportCreateBoards(this.currentBoard,i),this.boardList},P.prototype.findLine=function(t,e,i){var r,o=this.userData[t][e];for(let t=0,e=o.length;t<e;t++){const e=o[t];if("line"===e.type&&e.seq==i.belongSeq){r=e;break}}return r},P.prototype.setNeedDraw=function(t=!0){this.needDraw=t},P.prototype.getNeedDraw=function(){return this.needDraw},P.prototype.getBoardList=function(){return this.boardList},P.prototype.getBoardPicList=function(){return this.backgroundPic},P.prototype.setDefaultBoard=function(){this.currentGroup=g.COMMON_GROUP,this.addGroup(g.COMMON_GROUP,g.COMMON_GROUP),this.currentBoard=this.createBoardId(),this.addBoard(this.currentBoard),this.setBackgroundColor(o.formatColor(this.globalBackgroundColor),!0),delete this.setDefaultBoard},P.prototype.removeBoard=function(t){Array.isArray(t)||(t=[t]);var e=[],i=!1;for(let n=0,s=t.length;n<s;n++){var r,o=t[n];o!==g.COMMON_DEFAULT_BOARD?(r=this.boardList.indexOf(o))>-1&&(e.push(o),delete this.userData[o],delete this.data[o],delete this.opData[o],delete this.opIndex[o],o==this.currentBoard?(this.boardList.splice(r,1),this.currentBoard=this.boardList[r]?this.boardList[r]:this.boardList[r-1],i=!0):this.boardList.splice(r,1)):console.log("默认白板页不能删除")}return e.length&&f.fire(this,y.DELETE_BOARD,{current:this.currentBoard,list:this.boardList}),i&&this.fireSwitchBoardEvent(this.currentBoard,this.boardList),this.needDraw=!0,e},P.prototype.deleteBoard=function(t=this.currentBoard,e){var i=this.removeBoard(t)||[];return i.length&&(this.realTimeData.push({action:g.PROTOCOL_ACTION.SWITCH_ACTION,time:o.getTimeStamp(),seq:u.getSeq(),toBoardId:this.currentBoard,deleteBoards:e?[]:i,deleteFiles:e?[e]:[]}),this.report.reportDeleteBoard(i,this.currentBoard)),i},P.prototype.getGroup=function(){return this.groups},P.prototype.getBoardByGroup=function(t=g.COMMON_GROUP){return this.boardList.filter(e=>t===g.COMMON_GROUP&&e===g.COMMON_DEFAULT_BOARD||e.indexOf(`_${t}`)>-1)},P.prototype.addGroup=function(t,e,i,r,o){for(var n=!1,s=0,a=this.groups.length;s<a;s++){var l=this.groups[s];if(l.fid==l){n=!0;break}}return n?this.groups:(f.fire(this,y.ADD_FILE,t),t&&t!==g.COMMON_GROUP&&this.report.reportAddFile(t,e||t),this.groups.push({fid:t,title:e,downloadURL:i,pageCount:r,currentPageIndex:o}))},P.prototype.deleteGroup=function(t){if(t===g.COMMON_GROUP)return console.error("不允许删除默认的白板分组"),!1;for(var e=-1,i=0,r=this.groups.length;i<r;i++)if(this.groups[i].fid==t){e=i;break}return-1==e?(console.error("删除的分组不存在"),!1):(this.groups.splice(e,1),this.report.reportDeleteFile(t),this.getBoardByGroup(t))},P.prototype.setColor=function(t=m.RED){this.cancelSelect(),"number"==typeof t?this.color=o.dealColor(t):"string"!=typeof t||0!=t.indexOf("#")||4!==t.length&&7!==t.length||(this.color=o.hexToRgba(t))},P.prototype.getColor=function(){return this.color},P.prototype.setThin=function(t=g.THIN){this.cancelSelect(),this.thin=t},P.prototype.setTextSize=function(t=g.TEXTSIZE){this.cancelSelect(),this.textSize=t},P.prototype.getTextSize=function(){return this.textSize},P.prototype.setTextColor=function(t=m.RED){this.cancelSelect(),"number"==typeof t?this.textColor=o.dealColor(t):"string"!=typeof t||0!=color.indexOf("#")||4!==color.length&&7!==color.length||(this.textColor=o.hexToRgba(t))},P.prototype.getTextColor=function(){return this.textColor},P.prototype.getThin=function(){return this.thin},P.prototype.setRadius=function(t=g.RADIUS){this.cancelSelect(),this.radius=t},P.prototype.setType=function(t){var e=Object.values(_);"move"!=t&&this.cancelSelect(),e.indexOf(t)>-1?this.type=t:this.type=_.LINE},P.prototype.getType=function(){return this.type},P.prototype.setTransparent=function(t=!1){this.transparent=t},P.prototype.getTransparent=function(){return this.transparent},P.prototype.setBackgroundColor=function(t=m.WHITE,e){var i=this.currentBoard;"object"==typeof t&&(i=t.boardId,t=t.color);var r=0;"number"==typeof t?(this.backgroundColor[i]=o.dealColor(t),r=t):"string"!=typeof t||0!=t.indexOf("#")||4!==t.length&&7!==t.length||(this.backgroundColor[i]=o.hexToRgba(t),r=o.formatColor(o.hexToRgba(t))),this.needDraw=!0,e||(this.realTimeData.push({action:g.PROTOCOL_ACTION.UPDATE_BG_COLOR_ACTION,time:o.getTimeStamp(),seq:u.getSeq(),color:r,isGlobal:0}),this.report.reportSetBoardBgColor(i,r))},P.prototype.setSelectArea=function(t=0,e=0,i=0,r=0){this.selectArea={x:t,y:e,width:i,height:r}},P.prototype.getSelectArea=function(){return this.selectArea},P.prototype.getCurrentBoard=function(){return this.currentBoard},P.prototype.getCurrentFile=function(){return this.currentGroup},P.prototype.getData=function(){return this.data},P.prototype.getCurrentBoardData=function(){return{data:this.data[this.currentBoard],userData:this.userData[this.currentBoard],opData:this.opData[this.currentBoard],opIndex:this.opIndex[this.currentBoard],backgroundPic:this.backgroundPic[this.currentBoard],backgroundColor:this.backgroundColor[this.currentBoard]}},P.prototype.getCurrentBoardPic=function(){return this.backgroundPic[this.currentBoard]},P.prototype.getCurrentBoardColor=function(){return this.backgroundColor[this.currentBoard]},P.prototype.getSelectList=function(){return this.selectedList},P.prototype.clearBoard=function(t){this.currentBoard&&(this.data[this.currentBoard]=[],this.opData[this.currentBoard]=[],this.opIndex[this.currentBoard]=0,this.userData[this.currentBoard]={},this.userData[this.currentBoard][this.identifier]=[],t||(this.backgroundPic[this.currentBoard]={url:"",user:""},this.backgroundColor[this.currentBoard]=this.globalBackgroundColor),this.cancelSelect(),this.needDraw=!0)},P.prototype.clearFileDrawData=function(t){t.forEach(t=>{(this.getBoardByGroup(t)||[]).forEach(t=>{this.data[t]=[],this.opData[t]=[],this.opIndex[t]=0,this.userData[t]={},this.userData[t][this.identifier]=[]})}),this.cancelSelect(),this.needDraw=!0},P.prototype.clear=function(){this.clearBoard(),this.realTimeData.push({action:101,seq:u.getSeq()}),this.report.reportClear(this.currentBoard)},P.prototype.clearDraws=function(){this.clearBoard(!0),this.realTimeData.push({action:102,seq:u.getSeq()}),this.report.reportClearDraws(this.currentBoard)},P.prototype.clearFileDraws=function(t){if(t){Array.isArray(t)||(t=[t]),this.clearFileDrawData(t);var e=[];t.forEach(t=>{e=e.concat(this.getBoardByGroup(t))}),this.realTimeData.push({action:103,seq:u.getSeq(),fids:t}),this.report.reportClearDraws(e)}},P.prototype.clearAll=function(){this.report.reportCleanAll()},P.prototype.addBackgroundPic=function(t,e,i=!0){var r=[],n=[];if(Array.isArray(t)){if(!Array.isArray(e)||t.length!=e.length)return!1;r=t,n=e}else{if(Array.isArray(e))return!1;r=[t],n=[e]}var s=[];this.cancelSelect(),r.forEach((t,e)=>{t===this.currentBoard&&i&&this.realTimeData.push({action:g.PROTOCOL_ACTION.UPDATE_BG_IMG_ACTION,url:encodeURI(n[e]),time:o.getTimeStamp(),seq:u.getSeq(),mode:0,cleanBoard:0}),this.data[t]||this.addBoard(t),this.backgroundPic[t].url=n[e],this.backgroundPic[t].show=!0,s.push({type:"image",seq:u.getSeq(),content:{boardId:t,url:n[e],updateTime:o.getTimeStamp(),mode:0}})}),i&&this.report.reportImages(s)},P.prototype.setBackgroundPic=function(t){this.cancelSelect(),this.addBackgroundPic(this.currentBoard,t,!1),this.realTimeData.push({action:g.PROTOCOL_ACTION.UPDATE_BG_IMG_ACTION,url:t,time:o.getTimeStamp(),seq:u.getSeq(),mode:0,cleanBoard:0}),this.report.reportImage(this.currentBoard,t)},P.prototype.deleteBackgroundPic=function(t){this.cancelSelect(),this.backgroundPic[t].show=!1,this.needDraw=!0},P.prototype.cancelBackgroundPic=function(){this.cancelSelect(),this.deleteBackgroundPic(this.currentBoard),this.img.style.display="none",this.realTimeData.push({action:g.PROTOCOL_ACTION.DELETE_BG_IMG_ACTION,seq:this.getSeq()}),this.report.reportImage(this.currentBoard,"")},P.prototype.clearGlobalBgColor=function(){this.setGlobalBackgroundColor(this.options.globalBackgroundColor)},P.prototype.switchBoard=function(t){if(this.cancelSelect(),t&&!this.data[t])return console.error("没有这一页白板"),!1;t||(t=this.createBoardId(),this.addBoard(t)),this.currentBoard=t;var e=this.backgroundPic[this.currentBoard]?this.backgroundPic[this.currentBoard].url:"";e&&this.realTimeData.push({action:g.PROTOCOL_ACTION.UPDATE_BG_IMG_ACTION,url:e,time:o.getTimeStamp(),seq:u.getSeq(),mode:0,cleanBoard:0}),this.realTimeData.push({action:g.PROTOCOL_ACTION.SWITCH_ACTION,time:o.getTimeStamp(),seq:u.getSeq(),toBoardId:t,deleteBoards:[]}),this.sendRequest(),this.report.reportSwitchBoard(t),this.fireSwitchBoardEvent(this.currentBoard,this.boardList),this.needDraw=!0},P.prototype.setGlobalBackgroundColor=function(t=m.WHITE,e){var i=0;"number"==typeof t?(this.globalBackgroundColor=o.dealColor(t),i=t):"string"!=typeof t||0!=t.indexOf("#")||4!==t.length&&7!==t.length||(this.globalBackgroundColor=o.hexToRgba(t),i=o.formatColor(o.hexToRgba(t))),this.boardList.forEach(t=>{this.backgroundColor[t]=this.globalBackgroundColor}),this.needDraw=!0,e||(this.realTimeData.push({action:g.PROTOCOL_ACTION.UPDATE_BG_COLOR_ACTION,time:o.getTimeStamp(),seq:u.getSeq(),color:i,isGlobal:1}),this.report.reportGlobalBgColor(i))},P.prototype.resetOperation=function(){this.opData[this.currentBoard]=this.opData[this.currentBoard].slice(0,this.opIndex[this.currentBoard])},P.prototype.collectLineData=function(){return{start:(t,e)=>{var i=u.getSeq();this.belongLineSeq=i;var n=new s(this.identifier,{color:this.color,thin:this.thin,x:t,y:e,show:!0,seq:i,belongSeq:i});this.userData[this.currentBoard][this.identifier].push(n),this.data[this.currentBoard].push(n),this.opData[this.currentBoard].push(new r(this.identifier,{seq:n.seq,type:this.type})),this.opIndex[this.currentBoard]++;var a={action:g.PROTOCOL_ACTION.LINE_START_ACTION,color:o.formatColor(n.color),scale:100,thin:n.thin,time:o.getTimeStamp(),seq:n.seq,belongSeq:n.belongSeq,x:t,y:e};this.realTimeData.push(a)},draw:(t,e)=>{var i=this.userData[this.currentBoard][this.identifier].length,r=this.userData[this.currentBoard][this.identifier][i-1];r.setBorder(t,e);var o=u.getSeq();r.lines.push({x:t,y:e,seq:o});var n={action:g.PROTOCOL_ACTION.LINE_MOVE_ACTION,seq:o,belongSeq:this.belongLineSeq,x:t,y:e};this.realTimeData.push(n)},end:(t,e)=>{var i=this.userData[this.currentBoard][this.identifier].length,r=this.userData[this.currentBoard][this.identifier][i-1];r.setBorder(t,e);var n=u.getSeq();r.lines.push({x:t,y:e,seq:n});var s={action:g.PROTOCOL_ACTION.LINE_END_ACTION,belongSeq:this.belongLineSeq,seq:n,x:t,y:e};this.realTimeData.push(s);var a=[];r.lines.forEach(t=>{a.push({seq:t.seq,x:t.x,y:t.y})});var l={boardId:this.currentBoard,uid:this.identifier,colorRGBA:o.formatColor(this.color),scale:100,width:this.thin,time:r.time,updateTime:o.getTimeStamp(),seq:r.seq,hidden:0,points:a};console.log("linejson"+l),this.report.reportAddLine({boardId:this.currentBoard,uid:this.identifier,colorRGBA:o.formatColor(this.color),scale:100,width:this.thin,time:r.time,updateTime:o.getTimeStamp(),seq:r.seq,hidden:0,points:a})},over(t,e){this.end(t,e)}}},P.prototype.collectTextInputData=function(){return{start:(t,e,i,o)=>{var n=u.getSeq();this.belongLineSeq=n;var s=new InputText(this.identifier,{x:t/i*1e4,y:e/o*1e4,belongSeq:n});this.userData[this.currentBoard][this.identifier].push(s),this.data[this.currentBoard].push(s),this.opData[this.currentBoard].push(new r(this.identifier,{seq:s.seq,type:this.type})),this.opIndex[this.currentBoard]++},inputting:(t,e,i,r,o,n,s)=>{var a=this.userData[this.currentBoard][this.identifier].length,l=this.userData[this.currentBoard][this.identifier][a-1],d={action:g.PROTOCOL_ACTION.LINE_END_ACTION,belongSeq:this.belongLineSeq,seq:u.getSeq(),x:l.lines[l.lines.length-1].x,y:l.lines[l.lines.length-1].y};this.realTimeData.push(d)}}},P.prototype.collectEraserData=function(t,e){var i=this.eraserImpactCheck(t,e,this.radius);if(i.length>0){this.opData[this.currentBoard].push(new r("",{seq:i,type:this.type})),this.opIndex[this.currentBoard]++;var n={action:g.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:o.getTimeStamp(),seq:u.getSeq(),x:0,y:0,lines:i};i.length&&(this.realTimeData.push(n),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:o.getTimeStamp(),display:0,lines:i})),this.needDraw=!0}},P.prototype.collectRaserData=function(){return{start:(t,e)=>{var i=new d(this.identifier,{color:o.dealColor(m.RED),radius:this.thin,x:t,y:e,seq:u.getSeq()});this.seq=i.seq,this.userData[this.currentBoard][this.identifier].push(i),this.data[this.currentBoard].push(i);var r={action:g.PROTOCOL_ACTION.RASER_SHOW_ACTION,r:this.thin,seq:i.seq,x:t,y:e};this.realTimeData.push(r),this.needDraw=!0},draw:(t,e)=>{var i=this.userData[this.currentBoard][this.identifier].length;this.userData[this.currentBoard][this.identifier][i-1].location={x:t,y:e},this.needDraw=!0,this.realTimeData.push({action:g.PROTOCOL_ACTION.RASER_SHOW_ACTION,seq:u.getSeq(),x:t,y:e,r:this.thin})},end:(t,e)=>{var i=this.userData[this.currentBoard][this.identifier].length,r=this.userData[this.currentBoard][this.identifier][i-1];r.point={x:t,y:e},r.status=0;var o={action:g.PROTOCOL_ACTION.RASER_HIDE_ACTION,seq:r.seq};this.realTimeData.push(o),this.needDraw=!0},over(){var t=this.userData[this.currentBoard][this.identifier].length;this.userData[this.currentBoard][this.identifier][t-1].status=0,this.needDraw=!0}}},P.prototype.collectSelectData=function(){return{start:(t,e)=>{this.beforeMoveType="select";var i=new l(this.identifier,{startx:t,starty:e,x:t,y:e});this.seq=i.seq,this.userData[this.currentBoard][this.identifier].push(i),this.data[this.currentBoard].push(i)},draw:(t,e)=>{var i=this.userData[this.currentBoard][this.identifier].length;this.userData[this.currentBoard][this.identifier][i-1].location={x:t,y:e},this.needDraw=!0},end:(t,e,i,r)=>{for(var o=t>i?t:i,n=e>r?e:r,s=t+i-o,a=e+r-n,l=this.data[this.currentBoard].length-1;l>=0;l--){var d=this.data[this.currentBoard][l];"line"==d.type&&d.show?o>=d.border.maxX&&n>=d.border.maxY&&s<=d.border.minX&&a<=d.border.minY&&(d.select=!0,this.selectedList.push(d)):"graph"==d.type&&d.show&&o>=d.endPoint.x&&n>=d.endPoint.y&&s<=d.startPoint.x&&a<=d.startPoint.y&&(d.select=!0,this.selectedList.push(d))}this.selectArea={x:s,y:a,width:o-s,height:n-a},this.userData[this.currentBoard][this.identifier][this.userData[this.currentBoard][this.identifier].length-1].show=!1,this.needDraw=!0,this.selectedList.length&&this.setType("move")}}},P.prototype.collectPointSelectData=function(t,e){this.beforeMoveType="pointselect";for(var i=!1,r=this.data[this.currentBoard].length-1;r>=0;r--){var o=this.data[this.currentBoard][r];if("line"==o.type&&o.show){if(t<o.border.maxX&&t>o.border.minX&&e<o.border.maxY&&e>o.border.minY){i=!0,o.select=!0,this.selectedList=[o],this.selectArea={x:o.border.minX,y:o.border.minY,width:o.border.maxX-o.border.minX,height:o.border.maxY-o.border.minY};break}}else if("graph"==o.type&&o.show){var n=o.endPoint.x,s=o.endPoint.y,a=o.startPoint.x,l=o.startPoint.y;if(n<a&&(n+=a,n-=a=n-a),s<l&&(s+=l,s-=l=s-l),s+=this.thin,n+=this.thin,a-=this.thin,l-=this.thin,t>=a&&t<=n&&e>=l&&e<=s){i=!0,o.select=!0,this.selectedList=[o],this.selectArea={x:a,y:l,width:n-a,height:s-l};break}}}i&&(this.needDraw=!0,this.setType("move"))},P.prototype.collectMoverData=function(){return{beforeStart:(t,e)=>{if(0==this.selectedList.length)return!1;for(var i=!1,r=0;r<this.selectedList.length;r++){var o=this.selectedList[r];if("line"==o.type){if(o.border.minX<=t&&o.border.maxX>=t&&o.border.minY<=e&&o.border.maxY>=e){i=!0;break}}else if("graph"==o.type){var n=o.startPoint.x,s=o.endPoint.x,a=o.startPoint.y,l=o.endPoint.y;if(s<n&&(s+=n,s-=n=s-n),l<a&&(l+=a,l-=a=l-a),l+=this.thin,s+=this.thin,a-=this.thin,(n-=this.thin)<=t&&s>=t&&a<=e&&l>=e){i=!0;break}}}return!!i||(this.setType(this.beforeMoveType),this.cancelSelect(),this.needDraw=!0,!1)},start:(t,e)=>{var i=[];this.selectedList.forEach(t=>{"line"==t.type?i.push({uid:t.user,seq:t.seq,x:t.lines[0].x,y:t.lines[0].y}):"graph"==t.type&&i.push({uid:t.user,seq:t.startPoint.seq,x:t.startPoint.x,y:t.startPoint.y})}),this.opData[this.currentBoard].push(new r("",{seq:{origin:i,final:[]},type:this.type}))},draw:(t,e,i,r)=>{if(this.selectedList.length>0){for(var o=0;o<this.selectedList.length;o++){var n=this.selectedList[o],s=t-i,a=e-r;"line"==n.type?(n.border.maxX+=s,n.border.minX+=s,n.border.maxY+=a,n.border.minY+=a,n.lines.forEach(t=>{t.x+=s,t.y+=a})):"graph"==n.type&&(n.startPoint.x+=s,n.startPoint.y+=a,n.endPoint.x+=s,n.endPoint.y+=a)}this.selectArea.x+=s,this.selectArea.y+=a,this.needDraw=!0}},end:()=>{this.needDraw=!0;var t=[];if(0!=this.selectedList.length){this.selectedList.forEach(e=>{"line"==e.type?t.push({seq:e.seq,x:e.lines[0].x,y:e.lines[0].y,uid:e.user}):"graph"==e.type&&t.push({seq:e.startPoint.seq,x:e.startPoint.x,y:e.startPoint.y,uid:e.user})});var e={action:g.PROTOCOL_ACTION.MOVE_LINE_GRAPH_ACTION,seq:u.getSeq(),moves:t,time:o.getTimeStamp()};this.realTimeData.push(e);var i=[];this.selectedList.forEach(t=>{"line"==t.type?i.push({uid:t.user,seq:t.seq,x:t.lines[0].x,y:t.lines[0].y}):"graph"==t.type&&i.push({uid:t.user,seq:t.startPoint.seq,x:t.startPoint.x,y:t.startPoint.y})}),this.opData[this.currentBoard][this.opData[this.currentBoard].length-1].seq.final=i,this.opIndex[this.currentBoard]++;var r=[];t.forEach(t=>{for(var e=t.uid,i=0;i<this.userData[this.currentBoard][e].length;i++){var n=this.userData[this.currentBoard][e][i];if("line"==n.type&&t.seq==n.seq){var s=[];n.lines.forEach(t=>{s.push({seq:t.seq,x:t.x,y:t.y})}),r.push({type:"addLine",seq:u.getSeq(),content:{boardId:this.currentBoard,uid:n.user,colorRGBA:o.formatColor(n.color),scale:100,width:n.thin,time:n.time,updateTime:o.getTimeStamp(),seq:n.seq,hidden:0,points:s}})}else if("graph"==n.type&&t.seq==n.startPoint.seq){var a={type:{line:"addPatternLine",oval:"addPatternCircle",circle:"addPatternCircle",rect:"addPatternRectangle"}[n.graph],seq:u.getSeq(),content:{boardId:this.currentBoard,uid:this.identifier,colorRGBA:o.formatColor(n.color),scale:100,width:n.thin,time:n.time,updateTime:o.getTimeStamp(),hidden:0,beginPoint:{x:n.startPoint.x,y:n.startPoint.y,seq:n.startPoint.seq},endPoint:{x:n.endPoint.x,y:n.endPoint.y,seq:n.endPoint.seq}}};"oval"==n.graph||"circle"==n.graph?(a.content.fillRect=0,a.content.fillRect=n.solid?1:0):"rect"==n.graph&&(a.content.fillRect=0,a.content.fillRect=n.solid?1:0,a.content.cornerRadius=0),r.push(a)}}}),this.report.reportGraphData(r),this.setType(this.beforeMoveType)}}}},P.prototype.collectGraphData=function(){return{start:(t,e)=>{var i=this.type.split("-")[1],o=new a(this.identifier,{graph:i,color:this.color,thin:this.thin,seq:u.getSeq(),beginPoint:{x:t,y:e,seq:u.getSeq()},endPoint:{x:t,y:e,seq:u.getSeq()},show:!0,solid:this.type.indexOf("solid")>-1});this.seq=o.seq,this.userData[this.currentBoard][this.identifier].push(o),this.data[this.currentBoard].push(o),this.opData[this.currentBoard].push(new r(this.identifier,{seq:o.startPoint.seq,type:"graph"})),this.opIndex[this.currentBoard]++},draw:(t,e)=>{var i=this.userData[this.currentBoard][this.identifier].length,r=this.userData[this.currentBoard][this.identifier][i-1];r.endPoint.x=t,r.endPoint.y=e,"circle"==r.graph&&this.circleFix(r),this.needDraw=!0},end:(t,e)=>{var i=this.userData[this.currentBoard][this.identifier].length,r=this.userData[this.currentBoard][this.identifier][i-1];r.endPoint.x=t,r.endPoint.y=e,"circle"==r.graph&&this.circleFix(r),"line"!=r.graph&&this.graphFix(r),this.needDraw=!0;var n={seq:r.seq,time:o.getTimeStamp(),color:o.formatColor(this.color),scale:100,thin:this.thin,beginPoint:{x:r.startPoint.x,y:r.startPoint.y,seq:r.startPoint.seq},endPoint:{x:r.endPoint.x,y:r.endPoint.y,seq:r.endPoint.seq}};n.action={line:10,oval:11,circle:11,rect:12}[r.graph];var s={type:{line:"addPatternLine",oval:"addPatternCircle",circle:"addPatternCircle",rect:"addPatternRectangle"}[r.graph],seq:u.getSeq(),content:{boardId:this.currentBoard,uid:this.identifier,colorRGBA:o.formatColor(this.color),scale:100,width:this.thin,time:r.time,updateTime:o.getTimeStamp(),hidden:0,beginPoint:{x:r.startPoint.x,y:r.startPoint.y,seq:r.startPoint.seq},endPoint:{x:r.endPoint.x,y:r.endPoint.y,seq:r.endPoint.seq}}},a=this.type.indexOf("solid")>-1?1:0;n.action>10&&(n.fillRect=a,s.content.fillRect=a),12==n.action&&(n.cornerRadius=0,s.content.cornerRadius=0),this.realTimeData.push(n),this.report.reportGraphData([s])},over(t,e){this.end(t,e)}}},P.prototype.cancelSelect=function(){for(var t=0;t<this.selectedList.length;t++)this.selectedList[t].select=!1;this.selectedList=[],this.selectArea={x:0,y:0,width:0,height:0},this.needDraw=!0},P.prototype.eraserImpactCheck=function(t,e,i){var r=[];return this.data[this.currentBoard].forEach(o=>{if("line"==o.type&&o.show){var n=!1,s=o.border.maxX,a=o.border.maxY,l=o.border.minX,d=o.border.minY;if(s>=t&&a>=e&&l<=t&&d<=e?n=!0:s>=t&&l<=t?(T=Math.min(Math.abs(a-e),Math.abs(d-e)))<=i&&(n=!0):a>=e&&d<=e?(T=Math.min(Math.abs(s-t),Math.abs(l-t)))<=i&&(n=!0):s<t?(T=a<e?Math.pow(t-s,2)+Math.pow(e-a,2):Math.pow(t-s,2)+Math.pow(e-d,2))<=Math.pow(i,2)&&(n=!0):(T=a<e?Math.pow(t-l,2)+Math.pow(e-a,2):Math.pow(t-l,2)+Math.pow(e-d,2))<=Math.pow(i,2)&&(n=!0),!n)return;n=!1;for(var h=1;h<o.lines.length;h++){var c=o.lines[h],u=o.lines[h-1];if((T=this.getDistance(t,e,c.x,c.y,u.x,u.y))<=(i+this.thin)*(i+this.thin)){n=!0;break}}n&&(o.show=!1,r.push({uid:o.user,seq:o.seq}))}else if("graph"==o.type&&o.show)if("line"==o.graph)(T=this.getDistance(t,e,o.startPoint.x,o.startPoint.y,o.endPoint.x,o.endPoint.y))<=(i+this.thin)*(i+this.thin)&&(o.show=!1,r.push({uid:o.user,seq:o.startPoint.seq}));else if("rect"==o.graph)if(o.solid)t>o.startPoint.x&&e>o.startPoint.y&&t<o.endPoint.x&&e<o.endPoint.y&&(o.show=!1,r.push({uid:o.user,seq:o.startPoint.seq}));else{var p=this.getDistance(t,e,o.startPoint.x,o.startPoint.y,o.startPoint.x,o.endPoint.y),f=this.getDistance(t,e,o.startPoint.x,o.startPoint.y,o.endPoint.x,o.startPoint.y),g=this.getDistance(t,e,o.endPoint.x,o.endPoint.y,o.startPoint.x,o.endPoint.y),_=this.getDistance(t,e,o.endPoint.x,o.endPoint.y,o.endPoint.x,o.startPoint.y);Math.min(p,f,g,_)<=(i+this.thin)*(i+this.thin)&&(o.show=!1,r.push({uid:o.user,seq:o.startPoint.seq}))}else if("circle"==o.graph){var m=(o.startPoint.x+o.endPoint.x)/2,y=(o.startPoint.y+o.endPoint.y)/2,b=Math.sqrt(Math.pow(o.startPoint.x-o.endPoint.x,2)+Math.pow(o.startPoint.y-o.endPoint.y,2))/2,T=Math.sqrt(Math.pow(t-m,2)+Math.pow(e-y,2));o.solid?T<b+i&&(o.show=!1,r.push({uid:o.user,seq:o.startPoint.seq})):Math.abs(b-T)<=i+this.thin&&(o.show=!1,r.push({uid:o.user,seq:o.startPoint.seq}))}else if("oval"==o.graph){m=(o.startPoint.x+o.endPoint.x)/2,y=(o.startPoint.y+o.endPoint.y)/2;var D=Math.abs(o.startPoint.x-o.endPoint.x)/2,w=Math.abs(o.startPoint.y-o.endPoint.y)/2;if(D===w&&0===D)return;var v=Math.pow(t-m,2)/Math.pow(D,2)+Math.pow(e-y,2)/Math.pow(w,2),q=Math.pow(t-m+this.thin/2,2)/Math.pow(D,2)+Math.pow(e-y+this.thin/2,2)/Math.pow(w,2),B=Math.pow(t-m+this.thin/2,2)/Math.pow(D,2)+Math.pow(e-y-this.thin/2,2)/Math.pow(w,2),S=Math.pow(t-m-this.thin/2,2)/Math.pow(D,2)+Math.pow(e-y+this.thin/2,2)/Math.pow(w,2),P=Math.pow(t-m-this.thin/2,2)/Math.pow(D,2)+Math.pow(e-y-this.thin/2,2)/Math.pow(w,2);o.solid?(v<=1.2||q<=1.2||B<=1.2||S<=1.2||P<=1.2)&&(o.show=!1,r.push({uid:o.user,seq:o.startPoint.seq})):(v<=1.2&&v>=.8||q<=1.2&&q>=.8||B<=1.2&&B>=.8||S<=1.2&&S>=.8||P<=1.2&&P>=.8)&&(o.show=!1,r.push({uid:o.user,seq:o.startPoint.seq}))}}),r},P.prototype.getDistance=function(t,e,i,r,o,n){var s={};if(i==o)s.x=i,s.y=e;else{var a=(r-n)/(i-o),l=r-a*i,d=t+a*e;s.x=(d-a*l)/(a*a+1),s.y=a*s.x+l}return s.x>=i&&s.x<=o||s.x<=i&&s.x>=o?(s.x-t)*(s.x-t)+(s.y-e)*(s.y-e):Math.min((i-t)*(i-t)+(r-e)*(r-e),(o-t)*(o-t)+(n-e)*(n-e))},P.prototype.circleFix=function(t){var e=Math.abs(t.startPoint.x-t.endPoint.x)*this.width/1e4,i=Math.abs(t.startPoint.y-t.endPoint.y)*this.height/1e4;e>i?(t.endPoint.x=t.startPoint.x<t.endPoint.x?t.startPoint.x+1e4*i/this.boardWidth:t.startPoint.x-1e4*i/this.boardWidth,t.endPoint.x=parseInt(t.endPoint.x)):(t.endPoint.y=t.startPoint.y<t.endPoint.y?t.startPoint.y+1e4*e/this.boardHeight:t.startPoint.y-1e4*e/this.boardHeight,t.endPoint.y=parseInt(t.endPoint.y))},P.prototype.graphFix=function(t){var e=t.startPoint.x,i=t.startPoint.y,r=t.endPoint.x,o=t.endPoint.y;t.startPoint={x:e>r?r:e,y:i>o?o:i,seq:t.startPoint.seq},t.endPoint={x:e>r?e:r,y:i>o?i:o,seq:t.endPoint.seq}},P.prototype.sendRequest=function(){if(this.permissions){var t=JSON.parse(JSON.stringify(this.realTimeData)),e={seq:u.getSeq(),timestamp:o.getTimeStamp(),value:{boardId:this.currentBoard,operator:this.identifier,actions:t}};this.realTimeData=[],f.fire(this,y.RT_DATA,e)}},P.prototype.sendRequestSpecial=function(t,e){var i={seq:u.getSeq(),timestamp:o.getTimeStamp(),value:{boardId:t,operator:this.identifier,actions:e}};f.fire(this,y.RT_DATA,i)},P.prototype.addHistory=function(t){var e=this;this.sortBoard(),console.log(t),t.forEach(t=>{var i,r;if(t.content=JSON.parse(t.content),"setGlobalBG"===t.type);else if("createBoards"===t.type)t.content&&t.content.createBoards.forEach(t=>{(i=t)&&!e.userData[i]&&e.addBoard(i,!1)});else if("addFile"===t.type){for(var n=t.content.fid,l=t.content.title,d=t.content.downloadURL,h=t.content.pageCount,c=t.content.currentPageIndex,u=!1,p=0,f=e.groups.length;p<f;p++){var g=e.groups[p];if(g.fid==g){u=!0;break}}u||e.groups.push({fid:n,title:l,downloadURL:d,pageCount:h,currentPageIndex:c})}else i=t.content.boardId,r=t.content.uid,i&&!e.userData[i]&&e.addBoard(i,!1),i&&!e.userData[i][r]&&(e.userData[i][r]=[]);if(t.content.colorRGBA&&(t.content.color=o.dealColor(t.content.colorRGBA)),t.content.width&&(t.content.thin=t.content.width),"addLine"==t.type){var _;for(p=0;p<t.content.points.length-1;p++){var m=t.content.points[p].x,y=t.content.points[p].y,b=t.content.points[0].seq;0==p?_=new s(r,{color:t.content.color,thin:t.content.thin,x:m,y:y,seq:t.content.points[p].seq,belongSeq:b,show:!t.content.hidden}):(_.lines.push({x:m,y:y,belongSeq:b,seq:t.content.points[p].seq}),_.sort(),p==t.content.points.length-1&&(_.endSeq=t.content.points[p].seq)),_.setBorder(m,y)}_&&(e.userData[i][r].push(_),e.data[i].push(_))}else if("addText"==t.type);else if("displayLine"==t.type)t.content.lines.forEach(i=>{for(var o=0;o<e.userData[e.currentBoard][r].length;o++){var n=e.userData[e.currentBoard][r][o];"line"==n.type&&n.startSeq==i.seq?n.show=!!t.content.display:"graph"==n.type&&n.startPoint.seq==i.seq&&(n.show=!!t.content.display)}});else if("addPatternLine"==t.type||"addPatternCircle"==t.type||"addPatternRectangle"==t.type){t.content.graph={addPatternLine:"line",addPatternCircle:"oval",addPatternRectangle:"rect"}[t.type],t.content.beginPoint.x=t.content.beginPoint.x,t.content.endPoint.x=t.content.endPoint.x,t.content.beginPoint.y=t.content.beginPoint.y,t.content.endPoint.y=t.content.endPoint.y,t.content.seq=t.content.beginPoint.seq,t.content.show=!t.content.hidden,t.content.solid=!!t.content.fillRect;var T=new a(r,t.content);e.userData[i][r].push(T),e.data[i].push(T)}else if("image"==t.type)t.content.url?e.addBackgroundPic(t.content.boardId,t.content.url,!1,!1):e.deleteBackgroundPic(t.content.boardId);else if("clean"==t.type)e.clearBoard(!1);else if("cleanDraws"==t.type)e.clearBoard(!0);else if("switchBoard"==t.type){if(!i)return;(1*t.seq||0)>e.maxSeq?(e.maxSeq=t.seq,e.data[i]||e.addBoard(i,!1),e.currentBoard=i,e.fireSwitchBoardEvent(i,e.boardList)):q.report("throw_seq",{extra_info:JSON.stringify({seq:t.seq,maxSeq:e.maxSeq,boardId:i,method:"addHistory"})})}else"setBoardBG"==t.type?e.setBackgroundColor({boardId:i,color:t.content.colorRGBA},!0):"setGlobalBG"==t.type&&e.setGlobalBackgroundColor(t.content.colorRGBA,!0)}),e.needDraw=!0},P.prototype.undo=function(){this.cancelSelect();var t=this.opData[this.currentBoard][this.opIndex[this.currentBoard]-1];if(t){if("line"==t.type)for(var e=0;e<this.userData[this.currentBoard][t.user].length;e++){var i=this.userData[this.currentBoard][t.user][e];if(t.seq==i.seq){i.show=!1,this.realTimeData.push({action:g.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:o.getTimeStamp(),seq:u.getSeq(),lines:[{uid:t.user,seq:t.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:o.getTimeStamp(),display:0,lines:[{uid:t.user,seq:t.seq}]});break}}else if("eraser"==t.type)t.seq.forEach(t=>{for(var e=t.uid,i=0;i<this.userData[this.currentBoard][e].length;i++){var r=this.userData[this.currentBoard][e][i];"line"==r.type&&t.seq==r.seq?r.show=!0:"graph"==r.type&&t.seq==r.startPoint.seq&&(r.show=!0)}}),this.realTimeData.push({action:g.PROTOCOL_ACTION.ERASER_ACTION,display:1,time:o.getTimeStamp(),seq:u.getSeq(),lines:t.seq}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:o.getTimeStamp(),display:1,lines:t.seq});else if("graph"==t.type){for(e=0;e<this.userData[this.currentBoard][t.user].length;e++)if("graph"==(i=this.userData[this.currentBoard][t.user][e]).type&&t.seq==i.startPoint.seq){i.show=!1,this.realTimeData.push({action:g.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:o.getTimeStamp(),seq:u.getSeq(),lines:[{uid:t.user,seq:t.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:o.getTimeStamp(),display:0,lines:[{uid:t.user,seq:t.seq}]});break}}else if("move"==t.type){var r=[];t.seq.origin.forEach(t=>{for(var e=t.uid,i=0;i<this.userData[this.currentBoard][e].length;i++){var o=this.userData[this.currentBoard][e][i];if("line"==o.type&&t.seq==o.seq){var n=t.x-o.lines[0].x,s=t.y-o.lines[0].y;o.border.maxX+=n,o.border.minX+=n,o.border.maxY+=s,o.border.minY+=s,o.lines.forEach(t=>{t.x+=n,t.y+=s}),r.push({uid:e,seq:t.seq,x:t.x,y:t.y})}else"graph"==o.type&&t.seq==o.startPoint.seq&&(n=t.x-o.startPoint.x,s=t.y-o.startPoint.y,o.startPoint.x+=n,o.startPoint.y+=s,o.endPoint.x+=n,o.endPoint.y+=s,r.push({uid:e,seq:t.seq,x:t.x,y:t.y}))}}),this.realTimeData.push({action:g.PROTOCOL_ACTION.MOVE_LINE_GRAPH_ACTION,time:o.getTimeStamp(),seq:u.getSeq(),moves:r});var n=[];t.seq.origin.forEach(t=>{for(var e=t.uid,i=0;i<this.userData[this.currentBoard][e].length;i++){var r=this.userData[this.currentBoard][e][i];if("line"==r.type&&t.seq==r.seq){var s=[];r.lines.forEach(t=>{s.push({seq:t.seq,x:t.x,y:t.y})}),n.push({type:"addLine",seq:u.getSeq(),content:{boardId:this.currentBoard,uid:r.user,colorRGBA:o.formatColor(r.color),scale:100,width:r.thin,time:r.time,updateTime:o.getTimeStamp(),seq:r.seq,hidden:0,points:s}})}else if("graph"==r.type&&t.seq==r.startPoint.seq){var a={type:{line:"addPatternLine",oval:"addPatternCircle",circle:"addPatternCircle",rect:"addPatternRectangle"}[r.graph],seq:u.getSeq(),content:{boardId:this.currentBoard,uid:this.identifier,colorRGBA:o.formatColor(r.color),scale:100,width:r.thin,time:r.time,updateTime:o.getTimeStamp(),hidden:0,beginPoint:{x:r.startPoint.x,y:r.startPoint.y,seq:r.startPoint.seq},endPoint:{x:r.endPoint.x,y:r.endPoint.y,seq:r.endPoint.seq}}};"oval"==r.graph||"circle"==r.graph?a.content.fillRect=0:"rect"==r.graph&&(a.content.fillRect=0,a.content.cornerRadius=0),n.push(a)}}}),this.report.reportGraphData(n)}this.opIndex[this.currentBoard]--,this.needDraw=!0}},P.prototype.canUndo=function(){return 0!=this.opIndex[this.currentBoard]},P.prototype.redo=function(){this.cancelSelect();var t=this.opData[this.currentBoard][this.opIndex[this.currentBoard]];if(t){if("line"==t.type)for(var e=0;e<this.userData[this.currentBoard][t.user].length;e++){var i=this.userData[this.currentBoard][t.user][e];if(t.seq==i.seq){i.show=!0,this.realTimeData.push({action:g.PROTOCOL_ACTION.ERASER_ACTION,display:1,time:o.getTimeStamp(),seq:u.getSeq(),lines:[{uid:t.user,seq:t.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:o.getTimeStamp(),display:1,lines:[{uid:t.user,seq:t.seq}]});break}}else if("eraser"==t.type)t.seq.forEach(t=>{for(var e=t.uid,i=0;i<this.userData[this.currentBoard][e].length;i++){var r=this.userData[this.currentBoard][e][i];"line"==r.type&&t.seq==r.seq?r.show=!1:"graph"==r.type&&t.seq==r.startPoint.seq&&(r.show=!1)}}),this.realTimeData.push({action:g.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:o.getTimeStamp(),seq:u.getSeq(),lines:t.seq}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:o.getTimeStamp(),display:0,lines:t.seq});else if("graph"==t.type){for(e=0;e<this.userData[this.currentBoard][t.user].length;e++)if("graph"==(i=this.userData[this.currentBoard][t.user][e]).type&&t.seq==i.startPoint.seq){i.show=!0,this.realTimeData.push({action:g.PROTOCOL_ACTION.ERASER_ACTION,display:1,time:o.getTimeStamp(),seq:u.getSeq(),lines:[{uid:t.user,seq:t.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:o.getTimeStamp(),display:1,lines:[{uid:t.user,seq:t.seq}]});break}}else if("move"==t.type){var r=[];t.seq.final.forEach(t=>{for(var e=t.uid,i=0;i<this.userData[this.currentBoard][e].length;i++){var o=this.userData[this.currentBoard][e][i];if("line"==o.type&&t.seq==o.seq){var n=t.x-o.lines[0].x,s=t.y-o.lines[0].y;o.border.maxX+=n,o.border.minX+=n,o.border.maxY+=s,o.border.minY+=s,o.lines.forEach(t=>{t.x+=n,t.y+=s}),r.push({uid:e,seq:t.seq,x:t.x,y:t.y})}else"graph"==o.type&&t.seq==o.startPoint.seq&&(n=t.x-o.startPoint.x,s=t.y-o.startPoint.y,o.startPoint.x+=n,o.startPoint.y+=s,o.endPoint.x+=n,o.endPoint.y+=s,r.push({uid:e,seq:t.seq,x:t.x,y:t.y}))}}),this.realTimeData.push({action:g.PROTOCOL_ACTION.MOVE_LINE_GRAPH_ACTION,time:o.getTimeStamp(),seq:u.getSeq(),moves:r});var n=[];t.seq.final.forEach(t=>{for(var e=t.uid,i=0;i<this.userData[this.currentBoard][e].length;i++){var r=this.userData[this.currentBoard][e][i];if("line"==r.type&&t.seq==r.seq){var s=[];r.lines.forEach(t=>{s.push({seq:t.seq,x:t.x,y:t.y})}),n.push({type:"addLine",seq:u.getSeq(),content:{boardId:this.currentBoard,uid:r.user,colorRGBA:o.formatColor(r.color),scale:100,width:r.thin,time:r.time,updateTime:o.getTimeStamp(),seq:r.seq,hidden:0,points:s}})}else if("graph"==r.type&&t.seq==r.startPoint.seq){var a={type:{line:"addPatternLine",oval:"addPatternCircle",circle:"addPatternCircle",rect:"addPatternRectangle"}[r.graph],seq:u.getSeq(),content:{boardId:this.currentBoard,uid:this.identifier,colorRGBA:o.formatColor(r.color),scale:100,width:r.thin,time:r.time,updateTime:o.getTimeStamp(),hidden:0,beginPoint:{x:r.startPoint.x,y:r.startPoint.y,seq:r.startPoint.seq},endPoint:{x:r.endPoint.x,y:r.endPoint.y,seq:r.endPoint.seq}}};"oval"==r.graph||"circle"==r.graph?a.content.fillRect=0:"rect"==r.graph&&(a.content.fillRect=0,a.content.cornerRadius=0),n.push(a)}}}),this.report.reportGraphData(n)}this.opIndex[this.currentBoard]++,this.needDraw=!0}},P.prototype.canRedo=function(){return this.opIndex[this.currentBoard]!=this.opData[this.currentBoard].length},P.prototype.syncHistroyData=function(){var t=this;t.clearBoard();var e=[],i=[],r=0,o=(t,n,s)=>{var a=(new Date).getTime();new Promise((e,i)=>{this.request.getBoardData(t,function(t){t.error_code?(q.report("getBoardData",{action_result:t.error_code,action_info:t.error_msg,time_consume:(new Date).getTime()-a,extra_info:JSON.stringify(t)}),i(`error_code:${t.error_code} error_msg:${t.error_msg}`)):(q.report("getBoardData",{time_consume:(new Date).getTime()-a,extra_info:JSON.stringify(t)}),e(t))},function(t){i(`error_code:${t} error_msg:HTTP请求错误，请重试`)})}).then(t=>{(t.board_data_list||[]).forEach(t=>{"setGlobalBG"===t.type?e.push(t):i.push(t)}),r++,!t.is_finish&&r<500?o(!1,n,s):n()}).catch(t=>{console.error("恢复课堂：",t)})};return new Promise((r,n)=>{o(!0,function(){t.addHistory(e),t.addHistory(i),t.sortBoard(),t.syncBoardSeq(),f.fire(this,y.HISTROY_DATA_COMPLETE)})})},P.prototype.sortBoard=function(){this.boardList=this.boardList.sort((t,e)=>(t===g.COMMON_DEFAULT_BOARD?0:t.match(/\d+_#\w+$/)[0].split("_")[0])-(e===g.COMMON_DEFAULT_BOARD?0:e.match(/\d+_#\w+$/)[0].split("_")[0]))},P.prototype.syncBoardSeq=function(){1==this.boardList.length&&this.boardList[0]===g.COMMON_DEFAULT_BOARD?this.boardIdSeq=1:this.boardList[this.boardList.length-1]&&(this.boardIdSeq=1*this.boardList[this.boardList.length-1].match(/\d+_#\w+$/)[0].split("_")[0]+1)},P.prototype.addData=function(t){if(this.permissions){q.report("addData",{extra_info:JSON.stringify(t)});var e=t.value.operator,i=t.value.actions,r=t.value.boardId;this.userData[r]||this.addBoard(r,!1),this.userData[r][e]||(this.userData[r][e]=[]),this.userData[r][e].length,i.forEach(t=>{if(t.color&&(t.color=o.dealColor(t.color)),1==t.action)(i=this.findLine(r,e,t))?(i.color=t.color,i.thin=t.thin,i.show=!0,i.lines.push({x:t.x,y:t.y,belongSeq:t.belongSeq,seq:t.seq}),i.sort(),i.setBorder(t.x,t.y)):((i=new s(e,t)).show=!0,this.userData[r][e].push(i),this.data[r].push(i));else if(2==t.action||3==t.action){var i;(i=this.findLine(r,e,t))?(i.lines.push({x:t.x,y:t.y,belongSeq:t.belongSeq,seq:t.seq}),i.sort(),i.setBorder(t.x,t.y)):(i=new s(e,t),this.userData[r][e].push(i),this.data[r].push(i)),3==t.action&&(i.endSeq=t.seq,((t,e)=>{setTimeout(()=>{t.color&&t.thin||this.request.getLineData({boardId:e,owner:t.user,seq:t.belongSeq},t=>{t.error_code||(this.addHistory([{content:t.content,type:t.type}]),this.sortBoard(),this.syncBoardSeq())})},500)})(i,r))}else if(6==t.action){this.userData[r][e].forEach(t=>{"raser"==t.type&&(t.status=0)});var n=new d(this.identifier,{color:t.color,radius:this.thin,x:t.x,y:t.y,seq:u.getSeq()});this.userData[r][e].push(n),this.data[r].push(n)}else if(7==t.action)this.userData[r][e].forEach(t=>{"raser"==t.type&&(t.status=0)});else if(8==t.action){if(!t.lines)return;t.lines.forEach(e=>{for(var i=0;i<this.userData[r][e.uid].length;i++){var o=this.userData[r][e.uid][i];"line"==o.type&&o.startSeq==e.seq?o.show=!!t.display:"graph"==o.type&&o.startPoint.seq==e.seq&&(o.show=!!t.display)}})}else if(9==t.action){if(!t.moves)return;t.moves.forEach(t=>{t.x=t.x,t.y=t.y;for(var e=0;e<this.userData[r][t.uid].length;e++){var i=this.userData[r][t.uid][e];if("line"==i.type&&i.startSeq==t.seq){var o=t.x-i.lines[0].x,n=t.y-i.lines[0].y;i.border.maxX+=o,i.border.minX+=o,i.border.maxY+=n,i.border.minY+=n,i.lines.forEach(t=>{t.x+=o,t.y+=n})}else"graph"==i.type&&i.startPoint.seq==t.seq&&(o=t.x-i.startPoint.x,n=t.y-i.startPoint.y,i.startPoint.x+=o,i.startPoint.y+=n,i.endPoint.x+=o,i.endPoint.y+=n)}})}else if(10==t.action||11==t.action||12==t.action){t.graph={10:"line",11:"oval",12:"rect"}[t.action],t.beginPoint.x=t.beginPoint.x,t.endPoint.x=t.endPoint.x,t.beginPoint.y=t.beginPoint.y,t.endPoint.y=t.endPoint.y,t.solid=!!t.fillRect,t.show=!0;var l=new a(e,t);this.userData[r][e].push(l),this.data[r].push(l)}else if(13==t.action){var h=new InputText(e,{x:t.x,y:t.y,belongSeq:t.belongSeq});h.seq=t.seq,h.color=t.color,h.scale=t.scale,h.typeFace=t.typeface,h.textSize=t.textSize,h.fontStyle=t.fontStyle,h.time=t.time,h.text=t.text,this.userData[r][e].push(h),this.data[r].push(h)}else if(101==t.action)this.clearBoard(!1);else if(102==t.action)this.clearBoard(!0);else if(103==t.action)try{this.clearFileDrawData(t.fids)}catch(t){}else if(201==t.action)this.addBackgroundPic(r,t.url,!1);else if(202==t.action)this.deleteBackgroundPic(r);else if(203==t.action)t.color&&(t.color=o.formatColor(t.color)),t.isGlobal?this.setGlobalBackgroundColor(t.color,!0):this.setBackgroundColor(t.color,!0);else if(401==t.action){var c=t.toBoardId;if((1*t.seq||0)>this.maxSeq){this.maxSeq=t.seq;var p=t.deleteFiles||[],f=t.deleteBoards||[];p.forEach(t=>{f=f.concat(this.getBoardByGroup(t))}),f.forEach(t=>{this.removeBoard(t)}),this.data[c]||this.addBoard(c,!1),this.currentBoard=c,this.fireSwitchBoardEvent(this.currentBoard,this.boardList)}else q.report("throw_seq",{extra_info:JSON.stringify({seq:t.seq,maxSeq:this.maxSeq,boardId:c,method:"addData"})})}}),this.needDraw=!0}},P.prototype.addFile=function(t,e,i){if(Array.isArray(t)){var r=`#${o.getTimeStamp()}`,n=[];return t.forEach(()=>{n.push(this.createBoardId(r))}),this.addGroup(r,e,i),this.addBoard(n),this.addBackgroundPic(n,t),setTimeout(()=>{n.length&&this.switchBoard(n[0])},200),r}},P.prototype.deleteFile=function(t){var e=this.deleteGroup(t);return f.fire(this,y.DELETE_FILE,t),!!e&&(this.deleteBoard(e),!0)},P.prototype.switchFile=function(t){for(var e=!1,i=0,r=this.groups.length;i<r;i++){var o=this.groups[i];if(o.fid==o){e=!0;break}}return e?(this.currentGroup=t,f.fire(this,y.SWITCH_FILE,t),t):(console.log("不存在该白板组"),!1)},P.prototype.getPreloadList=function(){var t=this.getBoardList(),e=t.indexOf(this.getCurrentBoard()),i="",r=0,o=this.getBoardPicList();t.forEach(t=>{r++});for(var n=new Array,s=e-this.preStep;s<=e+this.preStep;s++)s!=e&&s>0&&s<r&&""!=(i=o[t[s]].url)&&n.push(i);return n},P.prototype.fireSwitchBoardEvent=function(t,e){f.fire(this,y.SWITCH_BOARD,{current:t,list:e}),setTimeout(()=>{this.context.setPreLoadImgList(this.getPreloadList())},10)};var I=P;function x(t){this.option=Object.assign({},t),this.orientation=this.option.orientation||"vertical",this.conf_id=this.option.conf_id,this.canDraw=!1,this.isMoving=!1,this.needDraw=!1,this.store=new I(t),this.store.setDefaultBoard(),this.img=t.img,"horizontal"===this.orientation?(this.width=this.option.height,this.height=this.option.width):(this.width=this.option.width,this.height=this.option.height),this.canvasComponent=this.option.canvasComponent,this.context=this.option.context,this.init()}x.prototype.resize=function(t,e){this.width=t,this.height=e,this.store.setNeedDraw(!0)},x.prototype.getEventLocation=function(t){var e={x:0,y:0};e.x=t.changedTouches[0].x,e.y=t.changedTouches[0].y,"vertical"===this.data.orientation?(e.x=parseInt(e.x/this.data.width*1e4),e.y=parseInt(e.y/this.data.height*1e4)):(e.x=parseInt(e.x/this.data.height*1e4),e.y=parseInt(e.y/this.data.width*1e4))},x.prototype.draw=function(){var t=this,e=this.canvasComponent;e.clearRect(0,0,t.width,t.height),this.store.getTransparent();var i=this.store.getCurrentBoardData(),r=i.backgroundPic;r.url&&r.show?this.context.setCurrentImg(r.url,this.getCurrentBoard()):this.context.setCurrentImg("",this.getCurrentBoard()),i.backgroundColor?this.context.setBoardBgColor(i.backgroundColor):this.context.setBoardBgColor(""),function(){var r=i.data;if((r=r.sort((t,e)=>t.seq-e.seq)).forEach(i=>{var r,n;if("line"==i.type&&i.show)"horizontal"===t.orientation?(r=(1e4-i.lines[0].y)/1e4*t.height,n=i.lines[0].x/1e4*t.width):(r=i.lines[0].x/1e4*t.width,n=i.lines[0].y/1e4*t.height),i.lines.forEach(o=>{e.beginPath(),e.moveTo(r,n);let s=0,a=0,l=0;"horizontal"===t.orientation?(s=(1e4-o.y)/1e4*t.height,a=o.x/1e4*t.width,l=i.thin/1e4*t.width):(s=o.x/1e4*t.width,a=o.y/1e4*t.height,l=i.thin/1e4*t.height),e.lineTo(s,a),e.setLineWidth(l),e.setStrokeStyle(i.color),e.setLineCap("round"),e.stroke(),r=s,n=a});else if("raser"==i.type&&i.status){let r=0,n=0,s=0;"horizontal"===t.orientation?(r=(1e4-i.location.y)/1e4*t.height,n=i.location.x/1e4*t.width,s=i.radius/1e4*t.width):(r=i.location.x/1e4*t.width,n=i.location.y/1e4*t.height,s=i.radius/1e4*t.height),e.beginPath(),e.arc(r,n,s,0,2*Math.PI),e.setFillStyle(o.dealColor(m.RED)),e.fill(),e.closePath()}else if("select"==i.type&&i.show){let r=0,o=0,n=0,s=0;if("horizontal"===t.orientation){r=(1e4-i.startInfo.y)/1e4*t.height,o=i.startInfo.x/1e4*t.width;let e=r=(1e4-i.location.y)/1e4*t.height,a=o=i.location.x/1e4*t.width;n=e-r,s=a-o}else r=i.startInfo.x/1e4*t.width,o=i.startInfo.y/1e4*t.height,n=(i.location.x-i.startInfo.x)/1e4*t.width,s=(i.location.y-i.startInfo.y)/1e4*t.height;e.setLineDash([15,5]),e.setLineWidth(1),e.setStrokeStyle(t.store.color),e.strokeRect(r,o,n,s),e.setLineDash([])}else if("graph"==i.type&&i.show){let r=0,o=0,n=0,s=0,a=0;if("horizontal"===t.orientation?(r=(1e4-i.startPoint.y)/1e4*t.height,o=i.startPoint.x/1e4*t.width,n=(1e4-i.endPoint.y)/1e4*t.height,s=i.endPoint.x/1e4*t.width,a=i.thin/1e4*t.width):(r=i.startPoint.x/1e4*t.width,o=i.startPoint.y/1e4*t.height,n=i.endPoint.x/1e4*t.width,s=i.endPoint.y/1e4*t.height,a=i.thin/1e4*t.height),"line"==i.graph)e.beginPath(),e.moveTo(r,o),e.lineTo(n,s),e.setLineWidth(a),e.setStrokeStyle(i.color),e.setLineCap("round"),e.stroke();else if("rect"==i.graph){let t=r>n?n:r,l=o>s?s:o,d=r+n-2*t,h=o+s-2*l;e.setStrokeStyle(i.color),e.setLineWidth(a),i.solid?(e.setFillStyle(i.color),e.fillRect(t,l,d,h)):e.strokeRect(t,l,d,h)}else if("circle"==i.graph||"oval"==i.graph){let t=(r+n)/2,l=(o+s)/2,d=Math.abs(r-n)/2,h=Math.abs(o-s)/2;e.setStrokeStyle(i.color),e.setLineWidth(a),function(t,e,i,r,o,n,s){var a=.5522848,l=r*a,d=o*a;t.beginPath(),t.moveTo(e-r,i),t.bezierCurveTo(e-r,i-d,e-l,i-o,e,i-o),t.bezierCurveTo(e+l,i-o,e+r,i-d,e+r,i),t.bezierCurveTo(e+r,i+d,e+l,i+o,e,i+o),t.bezierCurveTo(e-l,i+o,e-r,i+d,e-r,i),t.closePath(),t.stroke(),n&&(t.setFillStyle(s),t.fill())}(e,t,l,d,h,i.solid,i.color),e.stroke()}}else"text"==i.type&&(e.beginPath(),e.font=i.textSize/1e4*t.height+"px "+(i.typeFace||"sans-serif"),e.setTextBaseline("top"),e.setFillStyle(i.color),e.fillText(i.text,i.location.x/1e4*t.width,i.location.y/1e4*t.height),e.stroke())}),t.isMoving){var n=t.store.getSelectArea(),s=t.store.getThin();e.setLineDash([15,5]),e.setLineWidth(1),e.strokeRect((n.x-s)/1e4*t.width,(n.y-s)/1e4*t.height,(n.width+2*s)/1e4*t.width,(n.height+2*s)/1e4*t.height),e.setLineDash([])}else{this.store.getSelectList().forEach(i=>{if("line"==i.type)e.setLineDash([15,5]),e.setLineWidth(1),e.strokeRect((i.border.minX-2*i.thin)/1e4*t.width,(i.border.minY-2*i.thin)/1e4*t.height,(i.border.maxX-i.border.minX+4*i.thin)/1e4*t.width,(i.border.maxY-i.border.minY+4*i.thin)/1e4*t.height),e.setLineDash([]);else if("graph"==i.type){var r=i.endPoint.x,o=i.endPoint.y,n=i.startPoint.x,s=i.startPoint.y;e.setLineDash([15,5]),e.setLineWidth(1),e.strokeRect((n-2*i.thin)/1e4*t.width,(s-2*i.thin)/1e4*t.height,(r-n+4*i.thin)/1e4*t.width,(o-s+4*i.thin)/1e4*t.height),e.setLineDash([])}})}e.draw()}.apply(this)},x.prototype.addBoard=function(){var t=this.store.createBoardId();this.store.addBoard(t)},x.prototype.getBoardData=function(){return JSON.parse(JSON.stringify(this.store.getData()))},x.prototype.addHistory=function(t){this.store.addHistory(t)},x.prototype.addData=function(t){this.store.addData(t)},x.prototype.deleteBoard=function(t){this.store.deleteBoard(t)},x.prototype.getBoardList=function(){return JSON.parse(JSON.stringify(this.store.getBoardList()))},x.prototype.getBoardPicList=function(){return JSON.parse(JSON.stringify(this.store.getBoardPicList()))},x.prototype.getCurrentBoard=function(){return this.store.currentBoard},x.prototype.getCurrentFile=function(){return this.store.getCurrentFile()},x.prototype.switchBoard=function(t){return this.store.switchBoard(t)},x.prototype.prevBoard=function(){var t=this.getBoardList(),e=this.getCurrentBoard(),i=t.indexOf(e);i<1||this.switchBoard(t[i-1])},x.prototype.nextBoard=function(){var t=this.getBoardList(),e=this.getCurrentBoard(),i=t.indexOf(e);i<t.length-1&&this.switchBoard(t[i+1])},x.prototype.setGlobalBackgroundColor=function(t){this.store.setGlobalBackgroundColor(t)},x.prototype.setBackgroundColor=function(t){this.store.setBackgroundColor(t)},x.prototype.init=function(){q.report("init",{extra_info:JSON.stringify({orientation:this.orientation,width:this.width,height:this.height})}),this.draw(),this.drawInterval=setInterval(()=>{this.store.getNeedDraw()&&(this.draw(),this.store.setNeedDraw(!1))},200)},x.prototype.setColor=function(t){this.store.setColor(t)},x.prototype.setThin=function(t){this.store.setThin(t)},x.prototype.setRadius=function(t){this.store.setRadius(t)},x.prototype.setType=function(t){this.store.setType(t)},x.prototype.undo=function(){this.store.undo()},x.prototype.canUndo=function(){return this.store.canUndo()},x.prototype.redo=function(){this.store.redo()},x.prototype.canRedo=function(){return this.store.canRedo()},x.prototype.clearBoard=function(t){this.store.clearBoard(t)},x.prototype.clear=function(){this.store.clear()},x.prototype.clearDraws=function(){this.store.clearDraws()},x.prototype.clearAll=function(){this.store.clearAll()},x.prototype.addBackgroundPic=function(t,e,i){this.store.addBackgroundPic(t,e,i)},x.prototype.setBackgroundPic=function(t){this.store.setBackgroundPic(t)},x.prototype.deleteBackgroundPic=function(t){this.store.deleteBackgroundPic(t)},x.prototype.cancelBackgroundPic=function(){this.store.cancelBackgroundPic()},x.prototype.clearGlobalBgColor=function(){this.store.clearGlobalBgColor()},x.prototype.cancelSelect=function(){this.store.cancelSelect()},x.prototype.setCanDraw=function(t=!1){this.canDraw=t},x.prototype.addFile=function(t,e){return this.store.addFile(t,e)},x.prototype.deleteFile=function(t){return this.store.deleteFile(t)},x.prototype.switchFile=function(t){return this.store.switchFile(t)},x.prototype.getGroup=function(){return this.store.getGroup()},x.prototype.getBoardByGroup=function(t){return this.store.getBoardByGroup(t)},x.prototype.clearFileDraws=function(t){return this.store.clearFileDraws(t)},x.prototype.setOrientation=function(t){this.orientation=t,this.store.setNeedDraw(!0)},x.prototype.layout=function(){var t=this.container.clientWidth,e=this.container.clientHeight,i=this.option.aspect,r=16,o=9;if(!1===i)this.width=t,this.height=e;else{if(void 0===i)r=16,o=9;else try{var n=i.split(":");r=1*n[0],r=isNaN(r)?16:r,o=1*n[1],o=isNaN(o)?9:o}catch(t){r=16,o=9}t/e>r/o?(this.width=e*r/o,this.height=e):(this.width=t,this.height=t*o/r)}var s=`position:relative;left: 50%;top: 50%;transform: translateX(-50%) translateY(-50%);width:${this.width}px;height:${this.height}px`;this.canvasWrap&&this.canvasWrap.setAttribute("style",s),this.el&&this.el.setAttribute("width",this.width),this.el&&this.el.setAttribute("height",this.height),this.img&&this.img.setAttribute("width",this.width),this.img&&this.img.setAttribute("height",this.height),this.bgDiv&&this.bgDiv.setAttribute("width",this.width),this.bgDiv&&this.bgDiv.setAttribute("height",this.height),this.store.setBoardSize(this.width,this.height)},x.prototype.drawLine=function(t,e,i,r){if(t.lineWidth=r/1e4*this.height,t.lineCap="round",t.strokeStyle=i,t.fillStyle=i,e.length<3){var o=e[0];return t.beginPath(),t.arc(o.x/1e4*this.width,o.y/1e4*this.height,t.lineWidth/2,0,2*Math.PI,!0),t.fill(),void t.closePath()}t.beginPath(),t.moveTo(e[0].x/1e4*this.width,e[0].y/1e4*this.height);for(var n=1;n<e.length-2;n++){var s=(e[n].x/1e4*this.width+e[n+1].x/1e4*this.width)/2,a=(e[n].y/1e4*this.height+e[n+1].y/1e4*this.height)/2;t.quadraticCurveTo(e[n].x/1e4*this.width,e[n].y/1e4*this.height,s,a)}t.quadraticCurveTo(e[n].x/1e4*this.width,e[n].y/1e4*this.height,e[n+1].x/1e4*this.width,e[n+1].y/1e4*this.height),t.stroke()};var E=x;function C(t){this.board=new E(t),this.version=g.VERSION,console.log("当前白板版本：",this.version)}C.DRAW_TYPE={LINE:"line",ERASER:"eraser",RASER:"raser",POINTSELECT:"pointselect",SELECT:"select",GRAPH_LINE:"graph-line",GRAPH_CIRCLE:"graph-circle",GRAPH_RECT:"graph-rect",GRAPH_OVAL:"graph-oval",GRAPH_CIRCLE_SOLID:"graph-circle-solid",GRAPH_RECT_SOLID:"graph-rect-solid",GRAPH_OVAL_SOLID:"graph-oval-solid"},C.prototype.resize=function(t,e){this.board.resize(t,e)},C.prototype.getBoardData=function(){return this.board.getBoardData()},C.prototype.getBoardPicList=function(){return this.board.getBoardPicList()},C.prototype.addData=function(t){this.board.addData(t)},C.prototype.addBoard=function(){this.board.switchBoard()},C.prototype.deleteBoard=function(t){this.board.deleteBoard(t)},C.prototype.prevBoard=function(){this.board.prevBoard()},C.prototype.nextBoard=function(){this.board.nextBoard()},C.prototype.getBoardList=function(){return this.board.getBoardList()},C.prototype.getCurrentBoard=function(){return JSON.parse(JSON.stringify(this.board.getCurrentBoard()))},C.prototype.getCurrentFile=function(){return JSON.parse(JSON.stringify(this.board.getCurrentFile()))},C.prototype.switchBoard=function(t){t?this.board.switchBoard(t):console.error("boardId 不能为空")},C.prototype.setGlobalBackgroundColor=function(t){this.board.setGlobalBackgroundColor(t)},C.prototype.setBackgroundColor=function(t){this.board.setBackgroundColor(t)},C.prototype.setColor=function(t){this.board.setColor(t)},C.prototype.setThin=function(t){this.board.setThin(t)},C.prototype.setRadius=function(t){this.board.setRadius(t)},C.prototype.setType=function(t){this.board.setType(t)},C.prototype.undo=function(){this.board.undo()},C.prototype.canUndo=function(){return this.board.canUndo()},C.prototype.redo=function(){this.board.redo()},C.prototype.canRedo=function(){return this.board.canRedo()},C.prototype.clear=function(){this.board.clear()},C.prototype.clearDraws=function(){this.board.clearDraws()},C.prototype.clearAll=function(){this.board.clearAll()},C.prototype.setBackgroundPic=function(t){this.board.setBackgroundPic(t)},C.prototype.clearBackgroundPic=function(){this.board.cancelBackgroundPic()},C.prototype.clearGlobalBgColor=function(){this.board.clearGlobalBgColor()},C.prototype.cancelSelect=function(){this.board.cancelSelect()},C.prototype.on=function(t,e){f.on(t,e)},C.prototype.addFileUrl=function(t,e){return this.board.addFile(t,e)},C.prototype.addFile=function(t,e,i){this.fileCos.uploadFile(t,(t,i)=>{this.board.addFile(i.picUrls,i.fileName),e&&e(t,i)},t=>{i&&i(t)})},C.prototype.addImgFile=function(t,e,i){this.fileCos.uploadFile(t,(t,i)=>{this.board.setBackgroundPic(i),e&&e(t,i)},t=>{i&&i(t)})},C.prototype.deleteFile=function(t){this.board.deleteFile(t)},C.prototype.switchFile=function(t){this.board.switchFile(t)},C.prototype.getAllFileInfo=function(){return this.board.getGroup()},C.prototype.getBoardByFile=function(t){return this.board.getBoardByGroup(t)},C.prototype.setCanDraw=function(t){return this.board.setCanDraw(t)},C.prototype.getPreloadList=function(t){return this.board.getPreloadList(t)},C.prototype.clearFileDraws=function(t){this.board.clearFileDraws(t)},C.prototype.setOrientation=function(t="vertical"){this.board.setOrientation(t)},e.default=C}]).default});